<html>
<head>
<title>Связь рисунков Visio с данными</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="../vis.css">
<link rel="icon" href="../favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="20%" align="center"><a href="../index.html"><img SRC="../vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="10%" align="center">&nbsp;</td>
<td class='menutd' width="70%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="../reg.htm">О форумах</a>
<br/>
 <a class="menu" href="../bib.htm">Библиотека</a> |
 <a class="menu" href="../faq.htm">Частые вопросы</a> |
 <a class="menu" href="../bookpdf.htm">Литература</a> |
 <a class="menu" href="../loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="../navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="../blog/">Blog</a> |
 <a class="menu" href="../inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="../site.htm">О сайте</a>
<br/>
 <a class="menu" href="../visicorp.htm">История Visio</a> |
 <a class="menu" href="../product.htm">Продукты Visio</a>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->

<h1>Связь рисунков Visio с данными</h1>
<p align="Right">Геннадий Туманов. 4 августа 2014 г.</p>
<h3>Варианты обеспечения связи</h3>
<p align="Justify">В последнее время в некоторых (даже весьма уважаемых) источниках появляются примерно такие утверждения:</p>
<p align="Justify"><b><i>"Рисунки, связанные с данными – это функция Visio профессиональный
 2013 и Visio Pro для Office 365 и она недоступна в Visio стандартный 
2013".</i></b></p>
<p align="Justify"><b><i>"Обновление данных работает только в одну сторону (из базы на 
диаграмму), т.е. штатными средствами обновление данных в источнике не 
сделать".</i></b></p>
<p align="Justify">Неправда все это! Вернее это бывает правдой в определенных случаях. Но 
начинающий пользователь не всегда может разобраться в тонкостях, поэтому
 такие утверждения сплошь и рядом его обманывают.</p>
<p align="Justify">Любая версия Visio всегда обеспечивала как минимум несколько способов связи рисунка с данными. Вот основные из них.</p>
<IMG SRC="r103/vd1.png" WIDTH="390" HEIGHT="304" BORDER="0" ALT="">

<p align="Justify">Возможность разработки своего дополнения, обеспечивающего связь рисунка 
Visio с листом Excel или таблицей базы данных, существовала всегда (по 
крайней мере, последние 15 лет). Это работало и в простейших и в самых 
профессиональных версиях. Причем дополнение могло писать данные в любую 
ячейку шейп-листа, то есть в любой атрибут шейпа (фигуры). Естественно, 
этот путь работает и сейчас, в том числе и в Visio 2013. Только он не 
для всех удобен, потому что требует навыков разработки дополнения (или 
написания макросов).</p>
<p align="Justify">Со временем Microsoft написала более-менее универсальное дополнение и 
стало включать его в комплект поставки. Это 5 визардов (помощников) для 
работы с БД. Визарды появились где-то в районе Visio 2000. Они считались
 ценными и включались в состав только профессиональных, дорогих версий. В
 Visio 2013 они тоже есть (только в профессиональном и Pro для 
Office365).</p>
<p align="Justify">Дополнение не было в должной мере документировано, поэтому осваивается 
непросто. По сравнению с произвольным дополнением набор функций был 
конечно ограничен, но достаточно широк для решения многих универсальных 
задач. Передача данных поддерживается в обе стороны – из БД в шейпы и из
 шейпов в БД.</p>
<p align="Justify">В качестве основного приемника данных в шейпах используются данные шейпа
 (Shape Data или несколько ранее Custom Properties). Хотя могут 
использоваться и другие атрибуты шейпов.</p>
<p align="Justify">С введением этого дополнения стала возможным связь рисунка Visio с 
источником данных без программирования, только с помощью настроек.</p>
<p align="Justify">В Visio 2007 введен еще более "продвинутый" элемент – окно "Внешние 
данные" и поддерживающий его транспорт данных. Принцип "без 
программирования" стал выражен еще ярче. Количество настроек снизилось. 
Количество выполняемых функций – тоже.</p>
<p align="Justify">Новая технология стала однонаправленной. Теперь данные движутся только 
от базы данных в рисунок Visio. Обратный путь не обеспечивается. 
Дополнение работает только в профессиональных версиях Visio.</p>
Одновременно введен еще и специальный элемент для отображения внешних 
данных Data Graphics – специальные выноски, которые могут автоматически 
прилепляться к любому шейпу после связывания его с внешними данными.</p>
<p align="Justify">И как всегда, наиболее широко рекламируется самое последнее достижение. В
 случае Visio им как раз и стала связка окна "Внешние данные" и 
отображение в Data Graphics. То есть наиболее простая для пользователя 
технология с минимум функций. Именно она обладает указанными в начале 
свойствами – однонаправленность передачи данных и поставка только с 
профессиональными версиями.</p>
<p align="Justify">Но забывать про наличие ранних, более мощных технологий – это большая 
ошибка. Да, они осваиваются чуть тяжелее. Зато их возможности намного 
превышают последний урезанный вариант. И, что тоже очень существенно, 
свое дополнение позволяет обойтись минимальной комплектацией Visio, а 
это может сэкономить (для Visio 2013) до 10 000 руб. на каждой лицензии.</p>
</p>
<h3 style="text-align: left;">Технология "Рисунки, связанные с данными"</h3>
<p align="Justify">Про эту технологию в последнее время сказано достаточно много. Вот несколько ссылок:</p>
<p align="Justify"><a href="https://rus-visio-blog-archive.github.io/2012/08/21/392.htm" target="_blank">
<b>Связывание схем с внешними данными</b></a> – пошаговый пример настройки связи между Visio 2010 и листом Excel.
 Тема Data Graphics не затрагивается.</p>
<p align="Justify"><a href="https://rus-visio-blog-archive.github.io/2012/09/10/419.htm" target="_blank">
<b>Создание новых рисунков, связанных с данными</b></a> – пошаговый пример добавления к шейпам предыдущей
 схемы элементов Data Graphics для отображения внешних данных.</p>
<p align="Justify"><a href="http://www.visguy.com/2009/02/23/trilogy-meter-data-graphics-part-i/" target="_blank">
<b>Trilogy-meter Data Graphics Part I</b></a>,
<a href="http://www.visguy.com/2009/02/23/2009/02/24/trilogy-meter-data-graphics-part-ii/" target="_blank">
<b>Part II</b></a>, <a href="http://www.visguy.com/2009/02/23/2009/02/24/trilogy-meter-data-graphics-part-iii/" target="_blank">
<b>Part III</b></a>,
 – к сожалению, только на английском. Подробное описание решения задачи с
 использованием связи Visio с внешними данными. В трех последовательных 
статьях показан как сам процесс настройки связи с данными, так и решение
 сопутствующих задач (создание своих элементов Data Graphics, импорт 
изображений, технология обновления данных). Создавалось еще в 2009 г. 
для Visio 2007.</p>
<p align="Justify"><a href="http://msdn.microsoft.com/en-us/library/aa468596%28v=office.12%29.aspx" target="_blank">
<b>Building Custom Data Graphics for Visio 2007</b></a>
 – базовая статья Марка Нельсона о том, что такое Data Graphics, какие 
они бывают, как их создавать и как применять. Тоже на английском. От 
2006 г., когда Data Graphics только зарождались.</p>
<p align="Justify"><a href="http://blogs.office.com/2014/06/30/creating-custom-data-graphics-in-visio/" target="_blank">
<b>Creating custom data graphics in Visio</b></a> – современный пошаговый пример создания собственных значков. На английском.</p>
Особенности технологии: данные двигаются только в одном направлении – из
 БД в рисунок Visio; технология доступна только в профессиональных 
версиях Visio.</p>
<p align="Justify"><b>Подробности</b></p>
<p align="Justify">Начиная с Visio 2007 объект документ Visio содержит коллекцию объектов 
DataRecordSet. Объект DataRecordSet отвечает за передачу данных из БД в 
Visio.</p>
<p align="Justify">Данные из DataRecordSet отображаются в окне "Внешние данные". Именно это
 окно пользователь видит и использует для настройки связи внешних данных
 с шейпами. Но программист имеет доступ и к самому объекту 
DataRecordSet, что позволяет использовать его в своих дополнениях, 
обеспечивающих, например, автоматическое соединение внешних данных с 
шейпами по определенному алгоритму.</p>
<p align="Justify">В момент создания связи строки внешних данных с шейпом в шейпе 
автоматически создаются строки данных шейпа (Shape Data), 
соответствующие полям внешних данных. Строки добавляются только в том 
случае, если шейп не имеет строк данных с нужными наименованиями. То 
есть, если нужные поля создать заранее, они будут найдены и заполнены 
автоматически.</p>
<p align="Justify"><b>Область применения</b></p>
<p align="Justify">Сокращенные возможности технологии предполагают и соответствующее 
сужение области применения. Технология применяется там, где нужно быстро
 добавить индикацию внешних данных на каком-либо готовом рисунке.</p>
<p align="Justify">Яркий пример использования приведен на странице
 <a href="http://unmanagedvisio.com/ru/%D0%BF%D1%80%D0%BE%D0%B4%D1%83%D0%BA%D1%82%D1%8B/%D0%BA%D0%B0%D1%80%D1%82%D0%B0-%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D1%85-%D1%80%D0%B5%D0%B3%D0%B8%D0%BE%D0%BD%D0%BE%D0%B2-%D0%B4%D0%BB%D1%8F-visio/" target="_blank">
 <b>Карта Российских регионов</b></a>.
 Здесь к основе (множество шейпов, составляющих карту) подключаются 
данные с сайта переписи населения в формате Excel. В результате на карте
 появляются в виде индикаторов данные о составе населения. Естественно, к
 одной и той же основе могут быть подключены различные источники данных 
для отображения нужной информации.</p>
<p align="Justify">Основа не обязательно создается вручную. Она может быть получена другим 
дополнением Visio, например, путем автоматического построения оргсхемы 
организации. То есть сначала с помощью визарда оргсхем изображается 
структура организации, потом на нее накладывается нужная текущая 
информация из другой базы или файла.</p>
<p align="Justify">Технология не обязательно заканчивается на Data Graphics. Для многих 
применений достаточно того, что данные появляются в Shape Data. При этом
 они легко могут просматриваться в интерактивном режиме через окно 
"Данные шейпа".</p>
<p align="Justify">Наконец после появления внешних данных в Shape Data они могут 
отображаться не только в индикаторах, добавляемых к шейпу-основе. Этот 
шейп сам по себе может быть выполнен по технологии смарт-шейпа и 
изменяться в зависимости от данных. Вот пример, в котором смарт-шейпы 
применены в качестве таких сложных индикаторов, отображающих 
интенсивность использования веб-сервисов на предприятии.</p>
<IMG SRC="r103/vd3.png" WIDTH="341" HEIGHT="152" BORDER="0" ALT="">

<p align="Justify">Здесь каждый универсальный индикатор получает через внешние данные 
текущее значение измеряемого показателя, ограничители для раскраски и 
десяток предыдущих значений для отображения предыстории. Данные 
обновляются и публикуются по расписанию. Таким образом, довольно 
простыми средствами формируется экран для отображения измеряемых 
показателей.</p>

<h3 style="text-align: left;">Технология DataBase визардов</h3>
<p align="Justify">Пример подключения внешних данных из Excel к рисунку Visio 2003 рассмотрен в
 статье <a href="http://visioport.ru/biblio/visiobdexcel.htm" target="_blank"><b>Связь шейпов Visio с данными в Excel</b></a>.
 Пример охватывает подготовку файла в Excel, настройку связи, настройку 
шейпов для отображения данных, прямое и обратное обновление данных. Как 
уже отмечалось, по этой технологии передача данных осуществляется в обе 
стороны.</p>
<p align="Justify">Через меню Add-Ons / Visio Extras в Visio 2007 доступны следующие дополнения:</p>

<ul style="text-align: left;">
<li>Database Export Wizard</li>
<li>Database Refresh</li>
<li>Database Settings...</li>
<li>Database Update</li>
<li>Database Wizard</li>
<li>Export to Database...</li>
<li>Link to ODBC Database.</li>
</ul>
<p align="Justify">Два из них (Database Refresh и Database Update) являются простыми 
исполняющими дополнениями, а остальные 5 выполнены по типу визардов, 
подразумевающих настройку выполняемых операций.</p>
<p align="Justify">Совсем не обязательно использовать весь этот комплект дополнений 
полностью. В описанном выше примере понадобились только Database 
Settings, Link to ODBC Database, Database Refresh и Database Update. В 
других задачах могут быть задействованы другие комбинации.</p>
<p align="Justify">Общая схема передачи данных следующая</p>

<IMG SRC="r103/vd2.png" WIDTH="541" HEIGHT="74" BORDER="0" ALT="">

<p align="Justify">DataBase дополнение использует выбираемый при настройке ODBC драйвер, 
связывающий его с нужным источником – таблицей БД или файлом Excel. В 
рисунке Visio данные поставляются в секцию Shape Data.</p>
<p align="Justify">Так же как и в вышеописанной технологии, целевой шейп может быть 
автоматически подстроен для приема данных в момент настройки соединения.
 В секцию добавляются именованные строки для приема данных, существующих
 в присоединяемой таблице.</p>
<p align="Justify">Технология в основном рассчитана на ручную работу, хотя синхронизирующие
 дополнения Refresh и Update, как и любое дополнение могут быть вызваны 
программным путем из некоторого пользовательского приложения.</p>
<p align="Justify"><b>Область применения</b></p>
<p align="Justify">Технология в принципе могла бы использоваться везде, где сейчас 
используется технология с окном "Внешних данных", и дополнительно в тех 
случаях, когда нужна обратная передача данных. Она тоже не требует 
знания программирования.</p>
<p align="Justify">Тем не менее, широкого распространения она не получила. Причина скорее 
всего в том, что она уже вызывала трудности освоения у неподготовленного
 пользователя и в то же время не давала той свободы, которую 
предоставляет технология с разработкой своих дополнений.</p>
<p align="Justify">Существенным ограничением является то, что связь устанавливается между 
конкретным шейпом и конкретной таблицей БД. Связываемые объекты должны 
появиться заранее и не поддерживаются сложные связки данных.</p>

<h3 style="text-align: left;">Разработка своих дополнений</h3>
<p align="Justify">Главное отличие этой технологии в том, что во всех остальных 
пользователю приходилось подстраиваться под функции, предоставляемые 
чужим дополнением. В этой технологии подстраиваться не надо, сделать 
можно все, что угодно.</p>
<p align="Justify">Для связи с базой данных обычно используется ADODB, предоставляющий всю мощь SQL,
 произвольные запросы к любым таблицам БД.</p>

<IMG SRC="r103/vd4.png" WIDTH="578" HEIGHT="107" BORDER="0" ALT="">
 
<p align="Justify">К рисунку Visio доступ осуществляется через объектную модель Visio, то есть к произвольным объектам.</p>
<p align="Justify">Но большие возможности сопровождаются большим разнообразием решений. 
Единственная типовая схема приложения типа окна "Внешние данные" уже не 
сможет закрыть всего этого разнообразия.</p>
<p align="Justify">Один из возможных примеров, в котором Visio выступает в качестве 
графического редактора данных, находящихся в базе, показан в статье
 <a href="https://visioport.ru/biblio/st107.htm" target="_blank">
 <b>Пример приложения для двустороннего обмена данными с базой данных</b></a>.
 О других примерах, различных областях применения и возможных схемах приложений, пожалуй, лучше поговорить отдельно.</p>

<!-- --------------------------- -->
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru">Gennady Tumanov</a>
</div>

</div>
</body>
</html>

<html>
<head>
<title>Интерактивные методы размещения данных</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="vis.css">
<link rel="icon" href="favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="20%" align="center"><a href="index.html"><img SRC="vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="10%" align="center">&nbsp;</td>
<td class='menutd' width="70%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="reg.htm">О форумах</a>
<br/>
 <a class="menu" href="bib.htm">Библиотека</a> |
 <a class="menu" href="faq.htm">Частые вопросы</a> |
 <a class="menu" href="bookpdf.htm">Литература</a> |
 <a class="menu" href="loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="blog/">Blog</a> |
 <a class="menu" href="inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="site.htm">О сайте</a>
<br/>
 <a class="menu" href="visicorp.htm">История Visio</a> |
 <a class="menu" href="product.htm">Продукты Visio</a>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->

<h1>Интерактивные методы размещения данных</h1>
<p align="Justify">В процессе автоматизации на основе Visio часто приходится подбирать 
алгоритм автоматического размещения шейпов. Особенно актуальной эта 
задача становится при работе с внешними данными. В этой статье 
рассматривается прием, помогающий преодолеть существенную автономность 
страниц в документе Visio.</p>
<p align="Justify">Довольно часто возникает задача разместить в документе Visio некий 
связанный список данных. Например, перечень элементов, спецификацию, 
ведомость. Если этот список длинный, отдельные записи имеют разный 
объем, да еще и построить все надо автоматически, то задача становится 
непростой.</p>
<p align="Justify">Возьмем для примера такой широко распространенный технический документ,
 как перечень элементов. Вид у него примерно такой.</p>

<IMG SRC="r104/img000.jpg" WIDTH="400" HEIGHT="285" BORDER="0" ALT="">

<p align="Justify">Данные размещаются на нескольких листах. Запись табличного типа и может 
занимать одну, две или три строки. Между строками могут быть пробелы, 
причем их количество разное в зависимости от ситуации.</p>
<p align="Justify">Основная сложность в том, что при изменении данных они начинают сползать
 на другие листы и вручную отслеживать такие перемещения довольно 
неприятно.</p>
<p align="Justify">Для борьбы с этим применен в дополнении Visio введен специальный режим 
интерактивного редактирования. Макрос, размещающий данные в документе, 
сначала создает множество образов страниц на одном листе. Так, как 
показано на рисунке.</p>

<IMG SRC="r104/img001.jpg" WIDTH="700" HEIGHT="352" BORDER="0" ALT="">

<p align="Justify">При этом пользователь видит весь текст, включая последствия всех 
перемещений. Дальше начинается интерактивная подгонка: добавление 
межстрочных интервалов, перемещение блоков текста, даже вынос некоторой 
общей части текста в заголовок (при этом для заголовка создается новая 
запись). Набор команд для такого редактирования собран на одной экранной
 форме.</p>

<IMG SRC="r104/img004.jpg" WIDTH="300" HEIGHT="313" BORDER="0" ALT="">

<p align="Justify">Особенность метода в том, что в начале редактирования макрос сохраняет 
весь поток данных во внутренней коллекции. При каждой операции в первую 
очередь изменяется эта кол-лекция (записи добавляются, удаляются и 
т.д.), а потом весь документ перевыводится.</p>
<p align="Justify">По времени такой перевывод занимает от долей секунды до нескольких секунд, поэтому неприятные ощущения не возникают.</p>
В конце работы выполняется последняя команда "Порезать на листы для 
вывода", по которой листы-фантомы удаляются, а шейпы рисуются уже по 
слегка измененному алгоритму на "настоящих" последующих листах. В 
результате документ приобретает "нормальный" вид.</p>

<IMG SRC="r104/img009.jpg" WIDTH="700" HEIGHT="352" BORDER="0" ALT="">

<p align="Justify">Так как все редактирование сохранялось в коллекции, данные 
распределяются по листам точно так же, но уже не "в ширину", а "в 
глубину".</p>
<p align="Justify">После некоторой практики оптимальным был признан следующий набор команд редактирования (для перечня элементов):</p>
<p align="Justify">- проредить - селектируется запись начала блока данных, запись конца 
блока данных и нажимается кнопка команды. В результате после каждой 
записи в этом блоке добавляется одна пустая запись;</p>
<p align="Justify">- добавить - несколько пустых строк после каждой записи. Селектируется 
несколько записей, не обязательно подряд. После выполнения команды за 
каждой селектированной записью появляется заданное количество пустышек;</p>
<p align="Justify">- удалить - чаще всего применяется к неудачно вставленным пробелам. Селектированные записи удаляются;</p>
<p align="Justify">- перенести - селектируются три записи: начало и конец переносимого
 блока и точка вставки. Блок переносится в новое место.</p>
<p align="Justify">Остальные операции (для групп) - это специфика перечня элементов, здесь ее можно не рассматривать.</p>
<p align="Justify">Еще одна тонкость кроется в конструкции шейпа и соединении шейпов. Шейп,
 в который выводится одна запись, представляет собой группу из 
нескольких шейпов-колонок. Каждая колонка не только саморегулирующаяся 
(по высоте) в зависимости от количества текста, но и воздействует на 
высоту всей группы. То есть, если хотя бы в одной колонке количество 
строк увеличится, оно увеличится и во всей записи. А так как группы 
сцеплены в гирлянду, то нижние записи автоматически сдвигаются на 
нужное расстояние. Этот эффект просматривается в последней строке 
примера.</p>

<IMG SRC="r104/img010.jpg" WIDTH="400" HEIGHT="201" BORDER="0" ALT="">

<IMG SRC="r104/img011.jpg" WIDTH="400" HEIGHT="201" BORDER="0" ALT="">

<p align="Justify">Кстати, при попытках отслеживать изменение размеров в зависимости от 
количества текста в других приложениях (в том же Excel) почти все 
известные решения когда-нибудь, да ошибаются. Для Visio это "родная" 
задача, поэтому тут ошибок не бывает.</p>
<p align="Justify">Скорее всего прием с "фантомными" страницами применим не только в таких 
документах, как перечень. Предпосылками к его применению являются:</p>
<p align="Justify">1. Необходимость совмещения автоматического построения многостраничного документа с интерактивным редактированием.</p>
<p align="Justify">2. Возможность сохранения связи между данными в промежуточном хранилище и
 "фантомным" размещением, чтобы отредактированное размещение можно было 
перенести на физические страницы.</p>

<!-- --------------------------- -->
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru">Gennady Tumanov</a>
</div>

</div>
</body>
</html>

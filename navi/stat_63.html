<html><head>
<LINK REL="STYLESHEET" HREF="vis.css">
<title>События</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="../vis.css">
<link rel="icon" href="../favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="15%" align="center"><a href="../index.html"><img SRC="../vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="5%" align="center">&nbsp;</td>
<td class='menutd' width="50%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="../reg.htm">О форумах</a>
<br/>
 <a class="menu" href="../bib.htm">Библиотека</a> |
 <a class="menu" href="../faq.htm">Частые вопросы</a> |
 <a class="menu" href="../bookpdf.htm">Литература</a> |
 <a class="menu" href="../loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="../navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="../blog/">Blog</a> |
 <a class="menu" href="../inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="../site.htm">О сайте</a>
<br/>
 <a class="menu" href="../visicorp.htm">История Visio</a> |
 <a class="menu" href="../product.htm">Продукты Visio</a>
</td>
<td width="5%" align="center">&nbsp;</td>
<td width="25%" align="center">
<script async src="https://cse.google.com/cse.js?cx=f5e9a9cb1467f4600">
</script>
<div class="gcse-search"></div>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->

<h1>События</h1>
<h2> Перечень литературы </h2>
<p>17.10.2019&nbsp;<b><noindex><a target = new href=blog/18-registratsiya-sobytij-visio.html
 rel="nofollow">&nbspРегистрация событий Visio</a></noindex></b>&nbsp;&nbsp;<noindex>
Геннадий Туманов
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>06.08.2017&nbsp;<b><noindex><a target = new href=https://docs.microsoft.com/ru-ru/office/vba/api/visio.iviseventproc
 rel="nofollow">&nbspОбъект IVisEventProc (Visio)</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMicrosoft&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>06.08.2017&nbsp;<b><noindex><a target = new href=https://docs.microsoft.com/ru-ru/office/vba/api/visio.iviseventproc.viseventproc
 rel="nofollow">&nbspМетод IVisEventProc.VisEventProc (Visio)</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMicrosoft&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>06.08.2017&nbsp;<b><noindex><a target = new href=https://docs.microsoft.com/ru-ru/office/vba/visio/concepts/event-codesvisio
 rel="nofollow">&nbspКоды событий (Visio)</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMicrosoft&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>14.06.2014&nbsp;<b><noindex><a target = new href=https://docs.microsoft.com/en-us/previous-versions/office/developer/office-xp/aa140366(v=office.10)
 rel="nofollow">&nbspUsing the QueueMarkerEvent Add-on in Visio Solutions</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMicrosoft&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>14.06.2014&nbsp;<b><noindex><a target = new href=https://docs.microsoft.com/en-us/previous-versions/office/developer/office-xp/aa140328(v=office.10)
 rel="nofollow">&nbspCreating Visio 2002 Event Filters</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMicrosoft&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>05.07.2012&nbsp;<b><noindex><a target = new href=https://blog.bvisual.net/2012/07/05/automating-page-droplegend-in-visio-2010/
 rel="nofollow">&nbspAutomating Page.DropLegend in Visio 2010</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspDavid Parker&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>22.11.2011&nbsp;<b><noindex><a target = new href=https://mikeborozdin.com/post/handling-the-double-click-event-with-the-visio-api/
 rel="nofollow">&nbspHandling the Double-Click Event with the Visio API</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspMike Borozdin&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>29.12.2010&nbsp;<b><noindex><a target = new href=https://blog.bvisual.net/2010/12/29/preparing-for-visio-web-access-control-events/
 rel="nofollow">&nbspPreparing for Visio Web Access control events</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspDavid Parker&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>18.06.2007&nbsp;<b><noindex><a target = new href=https://blog.bvisual.net/2007/06/18/eventxfmod-can-cause-visio-to-stop-working/
 rel="nofollow">&nbspEventXFMod can cause Visio to stop working</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspDavid Parker&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<p>15.11.2004&nbsp;<b><noindex><a target = new href=https://surrogate-tm.github.io/mailant/2004/11/15/dev-luv-four-best-practices-when-event-handling-in-visio.htm
 rel="nofollow">&nbspFour Best Practices When Event Handling in Visio</a></noindex></b>&nbsp;&nbsp;<noindex>
Mai-lan
&nbsp;&nbsp;</noindex>(англ.) Четыре совета по обработке событий в Visio&nbsp</p>
<p>12.10.2004&nbsp;<b><noindex><a target = new href=https://surrogate-tm.github.io/mailant/2004/10/12/dev-luv-finding-the-shape-that-generated-the-click-event-in-visio.htm
 rel="nofollow">&nbspFinding the Shape That Generated the Click Event in Visio </a></noindex></b>&nbsp;&nbsp;<noindex>
Mai-lan
&nbsp;&nbsp;</noindex>(англ.) Поиск шейпа, сгенерировавшего Click Event в Visio&nbsp</p>
<p>&nbsp;<b><noindex><a target = new href=http://jheyman.github.io/blog/pages/VisioAutoCompute/
 rel="nofollow">&nbspAuto-computed values in Visio diagrams with VBA</a></noindex></b>&nbsp;&nbsp;<noindex>
<a target=new href="rel ="nofollow">&nbspJulien&nbsp;</a>
&nbsp;&nbsp;</noindex>&nbsp</p>
<h2> Ответы на вопросы</h2>
<p class="n">Как перехватить events в поле Value, если произошли изменения данных?</p>
<p class="v">Как перехватить events в поле Value, если произошли изменения данных?&nbsp;</p>
<p class="o">Вот такая конструкция (после выполнения макроса ttt) срабатывает на любое изменение первого шейпа на странице и через MsgBox перечисляет все изменившиеся ячейки, в том числе и пользовательские. Остается отфильтровать их и реагировать только на нужную ячейку.&nbsp;</p>
<p class="t">Dim WithEvents m_shpObj As Visio.ShapePublic Sub InitWith(ByVal aShape As Visio.Shape)	Set m_shpObj = aShapeEnd SubPrivate Sub m_shpObj_CellChanged(ByVal Cell As Visio.IVCell)	MsgBox Cell.Shape.Name & " " & Cell.Name & " changed to =" & Cell.FormulaEnd SubSub ttt()Set m_shpObj = ActivePage.Shapes(1)End Sub&nbsp;</p>
<p class="n">Почему срабатывает ShapeAdded при открытии файла?</p>
<p class="v">Работая через VBasic с Visio Type Library,я пытался использовать обработчик события ShapeAdded в клиенте (объявлена переменная dim WithEvents app As Visio.Application)Sub appVisio_ShapeAdded(ByVal Shape As Visio.IVShape)...End Subи пришел к неожиданному выводу - что он срабатывает при открытии файла *.WMF (не только при добавлении шейпов). При открытии стандартного *.VSD обработчик "молчит".Почему это? Может Visio при чтении такого файла воспринимает процесс как добавление шейпов или недоработка?&nbsp;</p>
<p class="o">При открытии стандартного vsd обработчик молчит, потому что просто открывается пустой рисунок.При открытии WMF Visio открывает для него пустой документ, а затем помещает на него картинку (WMF). Эта картинка является тоже шейпом, у него существует шейп-лист, полный набор атрибутов и т.д. То есть срабатывание добавления шейпа вполне закономерно и соответствует правилам Visio.&nbsp;</p>
<p class="n">Подскажите, можно ли отловить изменение шейпа?</p>
<p class="v">Подскажите, можно ли отловить изменение шейпа? Дело в том, что необходимо написать процедуру, запрещающую некоторые изменения шейпов. Стандартной функции нет (есть только при добавлении шейпа ShapeAdded или при изменении текста шейпа, а необходимо отловить изменение геометрии шейпа).&nbsp;</p>
<p class="o">На изменение геометрии срабатывает EventXFMod.Что-нибудь типа Shape.Cells("EventXFMod").Formula = "RUNADDON (""ThisDocument.ttt"")" позволит в дальнейшем при изменении геометрии шейпа выходить на макрос ttt.&nbsp;</p>
<p class="n">Где описывать обработчик ShapeAdded и как его вызывать?</p>
<p class="v">Где описывать обработчик ShapeAdded и как его вызывать?&nbsp;</p>
<p class="o">Обработчик будет вызываться сам, как только на страницу упадет шейп.Чтобы его описать, нужно вызвать Microsoft Visual Basic (Tools / Macros / Visual Basic Editor), щелкнуть слева по ThisDocument, справа в списке объектов выбрать Document, а еще правее в списке событий выбрать ShapeAdded.При этом на листе появится заготовка типа:&nbsp;</p>
<p class="t">Private Sub Document_ShapeAdded(ByVal Shape As IVShape)…End Sub&nbsp;</p>
<p class="o">Впишите туда для проверки MsgBox, например:&nbsp;</p>
<p class="t">Private Sub Document_ShapeAdded(ByVal Shape As IVShape)MsgBox "Ой, Добавилось!"End Sub&nbsp;</p>
<p class="o">Теперь возвращайтесь на страницу рисунка и добавьте любой шейп или просто проведите линию и наблюдайте, как срабатывает Ваш обработчик.&nbsp;</p>
<p class="n">Как отследить изменение в выделении?</p>
<p class="v">Подскажите, если не затруднит, как отследить изменение в выделении.Пробовал так:Private Sub ActiveWindow_SelectionChanged(ByVal Window As IVWindow)MsgBox TimeEnd SubНо не работает.&nbsp;</p>
<p class="o">А ассоциировать с реальным источником не забыли? Типа вот так:&nbsp;</p>
<p class="t">Dim WithEvents tt As Visio.WindowSub ttt()Set tt = ActiveWindowEnd SubPrivate Sub tt_SelectionChanged(ByVal Window As IVWindow)MsgBox "Changed"End Sub&nbsp;</p>
<p class="o">После выполнения ttt событие начинает срабатывать.&nbsp;</p>
<p class="n">есть ли возможность средствами VB отслеживать событие ShapeAdded?</p>
<p class="v">А есть ли возможность средствами того же VB отслеживать это событие ShapeAdded (в VBA я знаю, как это сделать)?&nbsp;</p>
<p class="o">Конечно, есть.Если приложение VB делается по технологии COM Add-in (в Visio 2002 стала поддерживаться) то все практически так же, как и в VBA. Это нужно скачать из Microsoft Visio 2002 SDK, он подсаживается в VB6 и добавляет к нему свой пример-шаблон. То есть там уже все понятно становится.А если технология Add-on, то посложнее. Это уже два разных приложения взаимодействуют. Пример по-моему в том же SDK есть (там еще и документация прилагается, правда на английском).&nbsp;</p>
<p class="n">Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику?</p>
<p class="v">Нужно сделать так, чтобы один из объектов группы исчезал и появлялся по двойному клику. Расскажите как.&nbsp;</p>
<p class="o">Зайдите в ТаблицуФигур группы и вставьте раздел Другие свойства.В ТаблицеФигур группы укажите следующие параметры:&nbsp;</p>
<p class="t">EventDblClick =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))&nbsp;</p>
<p class="o">И в фигуре, которая должна исчезнуть:&nbsp;</p>
<p class="t">Geometry1.NoShow =Sheet.ID!Prop.Row_1.Prompt&nbsp;</p>
<p class="o">где ID номер группы. Теперь при двойном нажатии эта фигура(ы) будет "исчезать" и "появляться".Можно еще вот как поступить, если требуется убирать из группы группу.1) Создать группу (как элемент будущей группы).2) Скопировать в буфер.3) Сделать специальную вставку Edit>Paste Special...4) С этим новым элементом создать группу.5) Зайдите в ТаблицуФигур группы и вставьте раздел Другие свойства.В ТаблицеФигур группы укажите следующие параметры:&nbsp;</p>
<p class="t">EventDblClick =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))&nbsp;</p>
<p class="o">И в группе которая должна исчезнуть:&nbsp;</p>
<p class="t">ImgWidth =Width*Sheet.ID!Prop.Row_1.PromptImgHeight =Height*Sheet.ID!Prop.Row_1.Prompt&nbsp;</p>
<p class="o">где ID номер группы. Теперь при двойном нажатии эта группа(ы) будет "исчезать" и "появляться".&nbsp;</p>
<p class="n">Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику 2?</p>
<p class="v">На строку IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt); 0); SETF(GetRef(Prop.Row_1.Prompt);1))В поле EventDblClick я получаю сообщение "Error in formula". В справке 5-го Визио я не могу найти GetRef. Что это?&nbsp;</p>
<p class="o">Измените =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))на&nbsp;</p>
<p class="t">=IF(Prop.Row_1.Prompt=1;SETF("Prop.Row_1.Prompt";0);SETF("Prop.Row_1.Prompt";1))&nbsp;</p>
<p class="o"> Примечание: задача решилась так.&nbsp;</p>
<p class="t">EventDblClick=IF(Prop.Row_1.Prompt=1;SETF("Prop.Row_1.Prompt";"0");SETF("Prop.Row_1.Prompt";"1"))&nbsp;</p>
<p class="o">в общей группе.В группе которая исчезает&nbsp;</p>
<p class="t">Width=Sheet.ID!Width*1*Sheet.ID!Prop.Row_1.PromptHeight=Sheet.ID!Height*0,7703*Sheet.ID!Prop.Row_1.Prompt&nbsp;</p>
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru"> Gennady Tumanov </a>
</div></div></body></html>

<html><head>
<LINK REL="STYLESHEET" HREF="vis.css">
<title>Структура</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="../vis.css">
<link rel="icon" href="../favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="15%" align="center"><a href="../index.html"><img SRC="../vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="5%" align="center">&nbsp;</td>
<td class='menutd' width="50%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="../reg.htm">О форумах</a>
<br/>
 <a class="menu" href="../bib.htm">Библиотека</a> |
 <a class="menu" href="../faq.htm">Частые вопросы</a> |
 <a class="menu" href="../bookpdf.htm">Литература</a> |
 <a class="menu" href="../loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="../navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="../blog/">Blog</a> |
 <a class="menu" href="../inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="../site.htm">О сайте</a>
<br/>
 <a class="menu" href="../visicorp.htm">История Visio</a> |
 <a class="menu" href="../product.htm">Продукты Visio</a>
</td>
<td width="5%" align="center">&nbsp;</td>
<td width="25%" align="center">
<script async src="https://cse.google.com/cse.js?cx=f5e9a9cb1467f4600">
</script>
<div class="gcse-search"></div>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->

<h1>Структура</h1>
<p>Рассмотрим, из каких частей состоит документ Visio и как эти части взаимодействуют между собой.</p>
<IMG SRC="st/stat_71_f/s_ws1.png" WIDTH="753" HEIGHT="583" BORDER="0" ALT="">

<h2>Оконная структура</h2>
<p>Оконная структура обычно не интересна пользователю и редко упоминается в руководствах. Однако разработчикам она в некоторых случаях нужна, поэтому имеет смысл начать с нее.</p>
<p>Главным окном является окно рисунка. Именно оно обычно откликается на Application.Windows(1) и имеет тип visDrawing. Понятно, что в программной деятельности оно участвует очень активно.</p>
<p>Вторым по значимости является окно трафаретов (тип visStencil). Оно является дочерним окном для окна рисунка и по умолчанию располагается слева от окна рисунка. Последнее не обязательно. Так как трафареты в принципе могут перемещаться и даже находиться в разных углах экрана, то Visio может создать несколько окон трафаретов и все они будут дочерними для окна рисунка.</p>
<p>Третьим по значимости выступает окно шейп-листа (тип visSheet). На картинке выше оно не показано. Это окно такого же уровня, как и окно рисунка, то есть не имеет родительского окна.</p>
<h2>Структура документа</h2>
<p>Теперь перейдем собственно к структуре документа Visio. Документ хранится в виде одного файла (например, vsdx, но не обязательно). Кстати, документом может быть не только рисунок. Трафарет - это тоже документ. И шаблон - документ. Но пока остановимся на рисунке.</p>
<p>Документ-рисунок состоит из одной или нескольких страниц (это собственно рисунок), трафарета документа (Document Stencil) и дополнительной информации.</p>
<p>Страницы показываются в окне рисунка. Активна всегда только одна страница, остальные изображаются вкладками в нижней левой части окна.</p>
<p>Трафарет документа по смыслу похож на обычные внешние трафареты, но в отличие от них он входит в состав документа и сохраняется в одном файле с документом (рисунком). Его назначение - хранить копии мастер-шейпов, которые были перенесены с внешних трафаретов в рисунок. Так чтобы можно было впоследствии открыть и посмотреть рисунок даже в том случае, если внешних трафаретов на новом месте не будет. Здесь задействует механизм наследования, который нужно будет рассматривать отдельно.</p>
<p>К дополнительной информации относятся во-первых, атрибуты самого документа, во-вторых, данные, которые нужны для рисования "с нуля". То есть даже в пустом документе, созданном без всякого шаблона, есть некая палитра по-умолчанию, набор шрифтов, несколько стилей по-умолчанию и т.д.</p>
<p>Также в файле документа может сохраняться так называемое "рабочее пространство" (Workspace). Причем пользователь сам устанавливает в момент сохранения рисунка, нужно ли сохранять и рабоее пространство тоже или обойтись без него.</p>
<p>Рабочее пространство описывает подключенные к рисунку внешние трафареты и параметры открытых дополнительных окон. Сами внешние трафареты сюда не входят, только ссылки на них.</p>
<h2>Взаимодействие трафаретов и рисунка</h2>
<p>Раз уж мы коснулись понятия трафарета, нужно хотя бы кратко остановиться на взаимодействии трафаретов и рисунка. Рассмотрим следующий фрагмент рисунка.</p>
<IMG SRC="st/stat_71_f/s_ws2.png" WIDTH="393" HEIGHT="273" BORDER="0" ALT="">
 
<p>Здесь показан процесс использования внешнего трафарета при создании рисунка. Имеется внейшний трафарет (Stencil) как набор заготовок для последующего использования. Начинка такого трафарета подбирается по теме или функциональному признаку, потом сохраняется в отдельном документе (с расширением vssx). Отдельный элемент в трафарете называется мастер-шейп или просто Master.</p>
<p>При создании рисунка мы (помимо рисунка) можем открыть нужные внешние трафареты и "перетаскивать" мастер-шейпы на страницу рисунка. Важно, что при этом всегда задействован трафарет документа, даже если он не открыт в окне трафаретов.</p>
<p>При перетаскивании мастер-шейпа на рисунок Visio всегда проверяет наличие такого же мастер-шейпа в трафарете документа. Если отсутствует, то сначала он добавляется туда, а только потом на страницу. А если уже имеется, то на страницу рисунка поступает шейп из трафарета документа.</p>
<p>На приведенной выше картинке показано, что рисунок состоит из четырех шейпов. Для их создания были использованы два мастер-шейпа из внешнего трафарета и копии обоих мастер-шейпов остались в трафарете документа.</p>
<p>Особая ситуация возникает, если когда-то при создании рисунка был использован мастер из одного трафарета, а через некоторое время пользователь пытается использовать мастер с таким же именем, но с другого трафарета. Или с того же, но уже модифицированного. Такая ситуация обычно рассматривается с понятием "наследование".</p>
<h2>Структура страницы</h2>
<p>Главное в этой структуре - две коллекции: <b>коллекция шейпов (Shapes)</b> и <b>коллекция соединений (Connects)</b>. Причем первая из них легко наблюдается пользователем, например, через Drawing Explorer, а до второй добраться значительно сложнее, в основном это делается программным способом.</p>
 <IMG SRC="st/stat_71_f/rr12.png" WIDTH="228" HEIGHT="228" BORDER="0" ALT="">
<p>Остальное содержимое следовало бы отнести к свойствам и характеристикам страницы, по крайней мере то содержимое, которое формируется по умолчанию. Но не все так однозначно. В пределах страницы существует еще несколько разделов, которые можно представить как дополнительные коллекции. Это коллекция слоев, данных пользователя (User Data) и опять же пользовательских данных (Shape Data или Custom Properties). Рассмотрение пользовательских данных отложим до структуры шейпа, а вот коллекцию слоев придется рассмотреть здесь.</p>
<p><b>Слой</b> - это некий признак, по которому могут быть объединены шейпы в пределах страницы. Причем слой имеет несколько свойств, с помощью которых можно управлять отображением шейпов. Например, сделать шейпы отнесенные на этот слой, невидимыми или подкрасить определенным цветом и т.д. Так вот набор слоев задается именно на уровне страницы. На другой странице того же документа будут уже другие слои.</p>
<p>Однако появляется слой во время работы с шейпом. То есть с точки зрения пользователя процесс выглядит так, будто слой создается для шейпа. Нужно помнить, что это не так. Просто в этот момент в перечень слоев страницы добавляется новый слой, а в свойства шейпа добавляется признак, что он отнесен на этот слой.</p>
<h2>Наконец-то добрались до шейпа.</h2>
<p><b>Шейп (Shape)</b> - это базовый элемент Visio, главное, что в нем есть. Понятие "шейп" объединяет в себе и картинку (например, линию или квадратик), которую видит начинающий пользователь на странице рисунка, и огромный массив данных, который продвинутый пользователь рассматривает через шейп-лист (ShapeSheet), и программный объект, обладающий свойствами и методами, которыми оперирует программист Visio. Поэтому я всегда возражаю против однобоких переводов в документации, когда Shape переводят как "фигура" или "объект". И делее шейп будет называться именно шейпом и никак не иначе.</p>
<p>Так вот, все изображение на странице Visio состоит из шейпов. Они могут быть совсем простыми, например, линия, прямоугольник. Могут составлять более сложное изображение. Наконец, несколько простых шейпов можно сгруппировать, в результате чего появится новый шейп - группа, который будет содержать дочерние шейпы.</p>
<p>Таким образом страница состоит из множества шейпов, обычных или групп. Группа состоит из множества шейпов, обычных или групп. И такая вложенность не ограничена.</p>
 <IMG SRC="st/stat_71_f/r11.png" WIDTH="326" HEIGHT="268" BORDER="0" ALT="">
<p>На картинке показано, как шейпы видны на странице и в окне Drawing Explorer. В данном случае коллекция шейпов страницы содержит два шейпа, один из них - группа. Группа в свою очередь состоит из трех шейпов.</p>
<p>Каждый шейп (и обычный и группа) имеют шейп-лист. Все форматирование и другие изменения, выполняемые пользователем над шейпом, отражаются в ячейках этого шейп-листа. И через шейп-лист производится программное управление свойствами (в том числе и изображением) шейпа.</p>
<p>Более того, так как страница и документ тоже имеют шейп-лист, то их тоже можно рассматривать как шейпы. И управлять ими программно через ячейки шейп-листа по аналогии с шейпами (хотя набор ячеек в шейп-листе будет несколько отличаться).</p>
<p>Каждый шейп имеет иденитификатор, уникальный в пределах страницы. Независимо от того, простой ли это шейп, группа или член группы. Шейпу можно присвоить вообще глобальный уникальный идентификатор, хотя делается это очень редко.</p>
<p>Существует также индекс, определяющий перекрытие изображений шейпов на странице, так называемый z-порядок шейпов. По умолчанию шейп, нарисованный позже, перекрывает ранее нарисованные. Соответственно, в наборе инструментов есть операции, позволяющие изменить этот порядок, переместить шейп выше или ниже.</p>
<h2>Что внутри шейпа</h2>
<p>Простой шейп - это уже нижний уровень иерархии, тем не менее, слегка заглянем и туда. Как уже отмечено выше, и изображение, и поведение шейпа определяются шейп-листом. Для удобства обращения к данным шейп-лист считают разделенным на несколько секций, отвечающих за свою часть поведения. Например, параметры линии, параметры заливки, геометрию, события и т.д. Глубже это рассматривается в описании шейп-листа. Здесь я только отмечу несколько следствий.</p>
<p>Простой шейп может иметь только один тип линии (толщина, цвет, образец и т.д.) и один тип заливки, потому что шейп-лист содержит только по одному такому разделу.</p>
<p>Однако в шейп-листе может быть несколько секций геометрии. Значит изображение одного шейпа может быть довольно сложным. Например, несколько кругов и квадратиков в одном шейпе. Такие шейпы обычно получаются с помощью операций объединения, вычитания и т.д. шейпов. Причем отдельные фрагменты этого изображения можно сделать невидимыми (установить признак для одной секции геометрии). Это свойство, кстати, часто закладывается в основу так называемых "мультифигур", когда шейп в зависимости от определенного условия может "переключать" свое изображение.</p>
<p>Шейп может иметь только один текстовый блок. Однако его можно разделить на несколько строк с помощью символов перевода строки. Можно по-разному отформатировать части этого блока, то есть в одном шейпе части текста будут разного цвета или выполнены разными шрифтами.</p>
<p>Пользователь может добавить в шейп как минимум два блока данных. Это User Data и Shape Data (ранее было Custom Properties). Причем не только в обычный шейп, но и в страницу и документ.</p>
<p><b>User Data</b> недоступны для пользовательского интерфейса. Они используются в основном программистами или пользователями, которые освоили работу с шейп-листом.</p>
<p><b>Shape Data</b> также доступны через шейп-лист, но помимо этого могут отображаться в специальном окне, что делает возможной работу с ними даже для начинающих пользователей. Этот блок данных перемещается вместе с шейпом, копируется и дублируется вместе с ним. Данные могут быть собраны в отчет. Очень часто этот блок используется для интеграции рисунка (диаграммы) с внешними источниками данных. Подробнее об этом - в других разделах.</p>
<h2>Соединения</h2>
<p>Выше упоминалось, что страница содержит две главные коллекции: шейпов и соединений. Шейпы рассмотрели, теперь переходим к соединениям.</p>
  <IMG SRC="st/stat_71_f/rr13.png" WIDTH="234" HEIGHT="123" BORDER="0" ALT="">
<p>В процессе ручного рисования понятие соединения в общем-то не нужно. Нарисовал квадрат, присоединил к нему коннектор - все и так понятно.</p>
<p>А вот у программистов, желающих проследить цепочки соединенных шейпов, нередко возникают сложности. Причина в том, что сведения о соединениях доступны программисту как свойства шейпа. И это запутывает картину.</p>
<p>При рассмотрении структуры страницы видно, что все соединения собраны в общую коллекцию. Каждый элемент этой коллекции описывает одно соединение двух шейпов и в этом описании всего 6 полей: какой шейп, какой ячейкой, каким боком соединен с каким шейпом, какой ячейкой и к какому боку (FromSheet, FromCell, FromPart, ToSheet, ToCell, ToPart). А методы, используемые программистом, всего лишь выбирают из этой общей коллекции строки, связанные с нужным шейпом и требуемое поле из этих строк.</p>
<h2> Перечень литературы </h2>
<p>10.06.2019&nbsp;<b><noindex><a target = new href=https://www.youtube.com/watch?v=KLlQERxelcU
 rel="nofollow">&nbspVisio Online Plan 2. Панель Навигация</a></noindex></b>&nbsp;&nbsp;<noindex>
Kuzin Alexander
&nbsp;&nbsp;</noindex>Видео&nbsp</p>
<p>&nbsp;<b><noindex><a target = new href=https://www.experts-exchange.com/articles/2680/Visio-Stencils-Masters-and-Shapes-How-are-they-related.html
 rel="nofollow">&nbspVisio Stencils, Masters and Shapes: How are they related?</a></noindex></b>&nbsp;&nbsp;<noindex>
Scott Helmers
&nbsp;&nbsp;</noindex>&nbsp</p>
<h2> Ответы на вопросы</h2>
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru"> Gennady Tumanov </a>
</div></div></body></html>

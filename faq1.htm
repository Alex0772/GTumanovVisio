<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><title>FAQ в категории Автоматизация</title>
<meta name="GENERATOR" content="MSHTML 5.00.2614.3500">
<meta content="text/html; charset=windows-1251" http-equiv="Content-Type">
<LINK REL="STYLESHEET" HREF="/vis.css">
<link rel="icon" href="/favicon.ico" />
</head>
<body bgcolor="white">
<div class="body_div">
<table class="tft" width="100%"><tr>
<td width="20%" align="center"><a href="/index.html"><img SRC="/vl1.gif" WIDTH="177" HEIGHT="80" BORDER="0" ALT=""></a>&nbsp;</td>
<td width="10%" align="center">&nbsp;</td>
<td class='menutd' width="70%" align="center">
 <a class="menu" href="http://visio.getbb.ru/">Форум visio.getbb.ru</a> |
 <a class="menu" href="/reg.htm">О форумах</a>
<br/>
 <a class="menu" href="/bib.htm">Библиотека</a> |
 <a class="menu" href="/faq.htm">Частые вопросы</a> |
 <a class="menu" href="/bookpdf.htm">Литература</a> |
 <a class="menu" href="/loading.htm">Склад материалов</a>
<br/>
 <a class="menu" href="/navi/png_1.htm">Visio Navigator</a> |
 <a class="menu" href="/blog/">Blog</a> |
 <a class="menu" href="/inforesurs.htm">Полезные ссылки</a> |
 <a class="menu" href="/site.htm">О сайте</a>
<br/>
 <a class="menu" href="/visicorp.htm">История Visio</a> |
 <a class="menu" href="/product.htm">Продукты Visio</a>
</td></tr></table>
<table width="100%" cellpadding="0" cellspacing="0" class="min"><tr><td width="10%" align="center">&nbsp;</td>
	<td width="90%">&nbsp;&nbsp;Для русскоязычных пользователей Visio. Начинающих и профессионалов.
Где взять, как сделать, что купить и т.д.
</td></tr></table>
<!-- основной контент -->
<h1>FAQ в категории Автоматизация</h1> 

<p><a href='#a166'>&nbsp;Как в VISIO 2002 автоматом создать карту сети?</a></p>
<p><a href='#a167'>&nbsp;Как визуализировать информацию из базы данных?</a></p>
<p><a href='#a168'>&nbsp;Цвет и толщина Network connector</a></p>
<p><a href='#a169'>&nbsp;Как описать функию, которая возвращала бы объект Visio.Shape?</a></p>
<p><a href='#a170'>&nbsp;Как можно объявить массив шейпов</a></p>
<p><a href='#a171'>&nbsp;Как создать документ Visio?</a></p>
<p><a href='#a172'>&nbsp;Как сохранить документ в формате .htm?</a></p>
<p><a href='#a173'>&nbsp;Не могу передать строку в .Cells("User....")</a></p>
<p><a href='#a174'>&nbsp;Как в VB работать с группой?</a></p>
<p><a href='#a175'>&nbsp;Как VB закрасить прямоугольник?</a></p>
<p><a href='#a176'>&nbsp;Как можно вставить Visio в Word?</a></p>
<p><a href='#a177'>&nbsp;Как программно отформатировать текст в шейпе?</a></p>
<p><a href='#a178'>&nbsp;Как красиво приклеить?</a></p>
<p><a href='#a179'>&nbsp;Подскажите, как в VBA получить координаты шейпа</a></p>
<p><a href='#a180'>&nbsp;Как выделить фигуры на слое?</a></p>
<p><a href='#a181'>&nbsp;Где взять инфу про Pinx и Piny?</a></p>
<p><a href='#a182'>&nbsp;Как обратиться к шейпу по координатам?</a></p>
<p><a href='#a183'>&nbsp;Почему в коде нельзя присвоить CustomProp тип Row = 1?</a></p>
<p><a href='#a184'>&nbsp;Как перехватить events в поле Value, если произошли изменения данных?</a></p>
<p><a href='#a185'>&nbsp;Пример работы с текстом и файлами.</a></p>
<p><a href='#a186'>&nbsp;Как можно закрепить длину линии?</a></p>
<p><a href='#a187'>&nbsp;Как программно добавить трафарет (*.vss) в уже открытый документ?</a></p>
<p><a href='#a188'>&nbsp;Как определить удаляемый шейп?</a></p>
<p><a href='#a189'>&nbsp;Почему срабатывает ShapeAdded при открытии файла?</a></p>
<p><a href='#a190'>&nbsp;Как определить путь?</a></p>
<p><a href='#a191'>&nbsp;Как задать требуемый номер и свойства элемента?</a></p>
<p><a href='#a192'>&nbsp;Как программно извлечь все свойства шейпа?</a></p>
<p><a href='#a193'>&nbsp;Как программно добраться до свойств шейпа (Properties)?</a></p>
<p><a href='#a194'>&nbsp;Подскажите, можно ли отловить изменение шейпа?</a></p>
<p><a href='#a195'>&nbsp;Как формировать список выбора в пользовательском поле?</a></p>
<p><a href='#a196'>&nbsp;Как формировать список выбора по данным из базы?</a></p>
<p><a href='#a197'>&nbsp;Где описывать обработчик ShapeAdded и как его вызывать?</a></p>
<p><a href='#a198'>&nbsp;Как задать программно формату ячейки форматную строку?</a></p>
<p><a href='#a199'>&nbsp;Как назначить свойство ActivePage программным образом?</a></p>
<p><a href='#a200'>&nbsp;Как извлечь свойства нестандартных шейпов?</a></p>
<p><a href='#a201'>&nbsp;Как из VISIO связывать Recordset с таблицей в базе данных?</a></p>
<p><a href='#a202'>&nbsp;Возможна ли передача значений из Custom... одного объекта в Custom... другого?</a></p>
<p><a href='#a203'>&nbsp;Как в Visio сделать ссылку на число?</a></p>
<p><a href='#a204'>&nbsp;Помогите подсчитать программно сколько в тексте на шейпе wrapped строк.</a></p>
<p><a href='#a205'>&nbsp;Как подсчитать получившееся количество строк при заполнении шейпа текстом?</a></p>
<p><a href='#a206'>&nbsp;Как в Visio 2002 включить автопозиционирование шаблона?</a></p>
<p><a href='#a207'>&nbsp;Как сослаться на шейп другого листа?</a></p>
<p><a href='#a208'>&nbsp;Как определить в Visual Basic цепочку из соединенных шейпов?</a></p>
<p><a href='#a209'>&nbsp;Можно ли получить доступ к Connection points шейпа из VB и удалить ненужные точки?</a></p>
<p><a href='#a210'>&nbsp;Как отследить изменение в выделении?</a></p>
<p><a href='#a211'>&nbsp;Как в EventDrop (секция Events) указать предыдущий объект?</a></p>
<p><a href='#a212'>&nbsp;Есть ли возможность средствами VB отслеживать событие ShapeAdded?</a></p>
<p><a href='#a213'>&nbsp;Есть функция в VB, возвращающая NAME шейпа без цифр?</a></p>
<p><a href='#a214'>&nbsp;Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику?</a></p>
<p><a href='#a215'>&nbsp;Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику 2?</a></p>
<p><a href='#a216'>&nbsp;Как программно можно поменять ориентацию страницы?</a></p>
<p><a href='#a217'>&nbsp;Как программно изменить размер и выравнивание шрифта в шейпе?</a></p>
<p><a href='#a218'>&nbsp;Можно ли значение кастом_пропертис использовать как номер скратч-ячейки?</a></p>
<p><a href='#a219'>&nbsp;Можно ли значение кастом_пропертис использовать как номер скратч-ячейки 2?</a></p>
<p><a href='#a220'>&nbsp;Как из Visio из процедуры на VBA получить доступ к листу в книге Excel?</a></p>
<p><a href='#a221'>&nbsp;Как менять несколько надписей сразу?</a></p>
<p><a href='#a222'>&nbsp;Как менять несколько надписей сразу 2?</a></p>
<p><a href='#a223'>&nbsp;Как определить размер (длину в мм) текстовой строки?</a></p>
<p><a href='#a224'>&nbsp;Как программно прижать текстовый блок коннектора к одному из концов?</a></p>
<p><a href='#a225'>&nbsp;Как определить к какому именно конекшен поинту произошло подключение?</a></p>
<p><a href='#a226'>&nbsp;Как изменить размеры шейпов по данным Excel?</a></p>
<p><a href='#a227'>&nbsp;Как сослаться на шейп на другой странице?</a></p>
<p><a href='#a228'>&nbsp;Как из скрипта можно установить единицу измерения?</a></p>
<h1>ShapeSheet</h1>
<p><a href='#a294'>&nbsp;Подсчет количества элементов</a></p>
<h1>VBA</h1>
<p><a href='#a295'>&nbsp;Изменение размеров рисунка</a></p>
<h1>Автоматизация</h1>
<p class='n' id='a166'>Как в VISIO 2002 автоматом создать карту сети?</p>
<p class='v'>Как в VISIO 2002 автоматом создать карту сети?</p>
<p class='o'>Вас интересует технология работы с комплектом Enterprise Networks Tools или вопрос задается, так сказать, с нуля?</p><p class='o'>Если с нуля, то… Нужно просканировать сеть, т.е. идентифицировать, определить типы имеющихся в ней устройств, получить их список. Нужно также иметь комплект шейпов для отображения всех устройств, которые при этом обнаружатся (несколько сотен типов - маршрутизаторы, коммутаторы, серверы и т.д. разных производителей). Наконец, программку, которая все эти шейпы с трафаретов перенесет на лист и соединит.</p><p class='o'>Все эти средства есть в дополнении Enterprise Networks Tools стоимостью около $1000. Говорят, что размещение получается не всегда оптимальным, но это легко исправляется.</p><p class='o'>Если задачи не глобальные, а попроще (например нужно только не спутать сервер с принтером) и сеть не слишком большая, то похожие компоненты можно написать и самому. Набор трафаретов будет попроще, сканер напишет практически любой программист, а для отображения нужен простейший алгоритм размещения и знакомство с объектной моделью Visio.</p>
<p class='n' id='a167'>Как визуализировать информацию из базы данных?</p>
<p class='v'>Я написал программу, опрашивающую по SNMP устройства сети и заносящую эту информацию в базу данных(ODBC). Теперь мне нужно визуализировать в Visio эту информацию. Вы не подскажете, как это можно сделать?</p>
<p class='o'>Принципы визуализации следующие:</p><p class='o'>1. У вас должен быть заготовлен трафарет с нужными мастер-шейпами.  В простейшем случае это Basic Network, в более сложных их существуют десятки для самых разнообразных сетевых устройств. Мастер-шейпы на трафарете адресуются по именам или индексам.</p><p class='o'>2. Из базы выбирается очередная строка; там должно быть имя или индекс имеющегося мастер-шейпа. Берется нужный мастер и укладывается на страницу рисунка.</p><p class='o'>3. Точно также берется и укладывается коннектор.</p><p class='o'>4. Каждый конец коннектора подцепляется к нужным точкам.</p><p class='o'>И так далее по всей базе. А вот иллюстрация (работа с базой опущена). Здесь рисуются два узла сети. Причем в данном случае трафарет Basic Network Shapes 3D.vss считается уже открытым (вручную). Это можно записать в качестве макроса и выполнить.</p>
<p class='t'>Sub&nbsp;Example()</p><p class='t'>'предположим&nbsp;нужно&nbsp;разместить&nbsp;сервер&nbsp;и&nbsp;рабочую&nbsp;станцию</p><p class='t'>'Цепляемся&nbsp;за&nbsp;открытый!&nbsp;трафарет&nbsp;Basic&nbsp;Network&nbsp;Shapes&nbsp;3D.vss,&nbsp;чтобы&nbsp;можно&nbsp;было</p><p class='t'>оперировать&nbsp;его&nbsp;шейпами</p><p class='t'>Set&nbsp;stnObj&nbsp;=&nbsp;Documents("Basic&nbsp;Network&nbsp;Shapes&nbsp;3D.vss")</p><p class='t'>'Выбираем&nbsp;с&nbsp;трафарета&nbsp;шейп&nbsp;с&nbsp;именем&nbsp;Server&nbsp;(там&nbsp;такой&nbsp;есть)</p><p class='t'>Set&nbsp;mastObj&nbsp;=&nbsp;stnObj.Masters("Server")</p><p class='t'>'Сажаем&nbsp;его&nbsp;под&nbsp;именем&nbsp;shpObj1&nbsp;в&nbsp;точку&nbsp;с&nbsp;координатами&nbsp;2,&nbsp;10&nbsp;на&nbsp;активную&nbsp;старницу</p><p class='t'>Set&nbsp;shpObj1&nbsp;=&nbsp;ActivePage.Drop(mastObj,&nbsp;2,&nbsp;10)</p><p class='t'>'Подпишем&nbsp;его</p><p class='t'>shpObj1.Text&nbsp;=&nbsp;"Хороший&nbsp;сервер"&nbsp;</p><p class='t'>'Поблизости&nbsp;делаем&nbsp;рабочую&nbsp;станцию&nbsp;из&nbsp;мастер-шейпа&nbsp;Workstation&nbsp;</p><p class='t'>Set&nbsp;mastObj&nbsp;=&nbsp;stnObj.Masters("Workstation")</p><p class='t'>Set&nbsp;shpObj2&nbsp;=&nbsp;ActivePage.Drop(mastObj,&nbsp;5,&nbsp;8)</p><p class='t'>shpObj2.Text&nbsp;=&nbsp;"Так&nbsp;себе&nbsp;станция"</p><p class='t'>'Теперь&nbsp;нужно&nbsp;добавить&nbsp;коннектор.&nbsp;Берем&nbsp;для&nbsp;этой&nbsp;цели&nbsp;Bottom&nbsp;to&nbsp;Top&nbsp;Angled</p><p class='t'>Set&nbsp;mstObjConnector&nbsp;=&nbsp;stnObj.Masters("Bottom&nbsp;to&nbsp;Top&nbsp;Angled")</p><p class='t'>Set&nbsp;shpObjConnector&nbsp;=&nbsp;ActivePage.Drop(mstObjConnector,&nbsp;0,&nbsp;0)</p><p class='t'>'Прячем&nbsp;его,&nbsp;чтобы&nbsp;не&nbsp;перекрывал&nbsp;основные&nbsp;шейпы</p><p class='t'>shpObjConnector.SendToBack</p><p class='t'>'И&nbsp;подсоединяем&nbsp;началом&nbsp;к&nbsp;серверу</p><p class='t'>shpObjConnector.Cells("BeginX").GlueTo&nbsp;shpObj1.Cells("Connections.X1")</p><p class='t'>'а&nbsp;концом&nbsp;к&nbsp;рабочей&nbsp;станции</p><p class='t'>shpObjConnector.Cells("EndX").GlueTo&nbsp;shpObj2.Cells("Connections.X1")</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a168'>Цвет и толщина Network connector</p>
<p class='v'>Еще один вопрос: как программно можно изменить цвет и толщину Network connector  который находится в Stencil Logical Symbols?</p>
<p class='o'>Цвет линии программно меняется в ячейке LineColor. В простейшем случае туда подставляются номера цветов из палитры, которая высвечивается в меню Format/Line/Color. Например, красный цвет имеет индекс 2. Толщина меняется в ячейке LineWeight. По умолчанию она устанавливается в дюймах (0,01 in - примерно 3 pt).</p><p class='o'>Применительно к предыдущему примеру для утолщения коннектора в три раза и окраски его в красный цвет нужно добавить</p><p class='o'>shpObjConnector.Cells("LineColor") = 2 </p><p class='o'>shpObjConnector.Cells("LineWeight") = 0.01 </p><p class='o'>Примечание. Если этот коннектор вам всегда будет нужен какой-то определенной толщины, может проще изменить его прямо в трафарете, тогда не нужно будет делать это для каждого экземпляра программно. Для этого трафарет открывается для редактирования, выполняется Edit Master, устанавливается нужная толщина и цвет или только толщина и сохраняется. Теперь этот коннектор будет перетаскиваться уже в нужном виде. Если нужно установить толщину в других единицах измерения, то используется конструкция shpObjConnector.Cells("LineWeight").Formula = "2 pt"</p>
<p class='n' id='a169'>Как описать функию, которая возвращала бы объект Visio.Shape?</p>
<p class='v'>Осталась одна маленькая загвоздка: можно ли как-нибудь описать функцию, которая возвращала бы объект Visio.Shape?</p>
<p class='o'>Например, вот так:</p>
<p class='t'>Public&nbsp;Function&nbsp;SetupRouter(docObj&nbsp;As&nbsp;Visio.Document,&nbsp;pagObj&nbsp;As&nbsp;Visio.Page,&nbsp;name</p><p class='t'>As&nbsp;String)&nbsp;As&nbsp;Visio.Shape</p><p class='t'>Dim&nbsp;mastObj&nbsp;As&nbsp;Visio.Master</p><p class='t'>Dim&nbsp;x&nbsp;As&nbsp;Double</p><p class='t'>Dim&nbsp;y&nbsp;As&nbsp;Double</p><p class='t'>x&nbsp;=&nbsp;4.25</p><p class='t'>y&nbsp;=&nbsp;9</p><p class='t'>Set&nbsp;mastObj&nbsp;=&nbsp;docObj.Masters("Router")</p><p class='t'>Set&nbsp;SetupRouter&nbsp;=&nbsp;pagObj.Drop(mastObj,&nbsp;x,&nbsp;y)</p><p class='t'>SetupRouter.Text&nbsp;=&nbsp;name</p><p class='t'>End&nbsp;Function</p>
<p class='n' id='a170'>Как можно объявить массив шейпов</p>
<p class='v'>Как можно объявить массив шейпов, и почему не работает вот это:</p><p class='v'>Dim shpRouters() As Visio.Shape</p><p class='v'>...........</p><p class='v'>Set pagsObj = ThisDocument.Pages</p><p class='v'>Set pagObj = pagsObj.Item(1)</p><p class='v'>Set stnObj = Documents.Add("Logical Symbols.vss")</p><p class='v'>Set mastObj = stnObj.Masters("Router")</p><p class='v'>Set shpRouters(1) = pagObj.Drop(mastObj, 4.25, 9) ?</p><p class='v'>Причем маршрутизатор он на страницу помещает, а вот двигать его в соответствии с координатами не хочет.</p>
<p class='o'>Это не работает, потому что здесь размерность массива нужно объявлять. По умолчанию не работает. Достаточно поставить Dim shpRouters(10) As Visio.Shape и ваш код уже выполняется. А насчет координат. У меня маршрутизатор и так размещается где надо. Только 4.25 и 9 Visio отсчитывает в дюймах и от левого нижнего угла рисунка. Может это вас сбивает?</p>
<p class='n' id='a171'>Как создать документ Visio?</p>
<p class='v'>Как создать документ Visio из других приложений (например Excel)? Задача: Создать ( или открыть ) документ Visio из другого приложения. ( Excel, FoxPro и т.д.). Проходит команда CreatObject("Visio.Drawing.6"). А дальше ???</p>
<p class='o'>Вот пример, создающий рисунок Visio с привычной надписью  "HelloWorld"</p><p class='o'>Берется Excel, вставляется в него этот макрос, (в VBA проекте нужно также не забыть подключить библиотеку типов Visio), запускается на выполнение.</p><p class='o'>Макрос создает экземпляр Visio, создает документ на основе шаблона Basic Diagram.vst (при этом открываются и соответствующие трафареты), перетаскивает с трафарета мастер-шейп Rectangle (квадрат) и вписывает в него текст "HelloWorld".</p><p class='o'>Потом в Excel'e сообщается о завершении работы через окно MsgBox.</p><p class='o'>После нажатия на кнопку OK Visio закрывается, а созданный рисунок сохраняется в файле hello.vsd.</p>
<p class='t'>Sub&nbsp;HelloWorld()</p><p class='t'>Dim&nbsp;appVisio&nbsp;As&nbsp;Visio.Application&nbsp;'Это&nbsp;экземпляр&nbsp;Visio</p><p class='t'>Dim&nbsp;docsObj&nbsp;As&nbsp;Visio.Documents&nbsp;'Коллекция&nbsp;документов&nbsp;Visio</p><p class='t'>Dim&nbsp;docObj&nbsp;As&nbsp;Visio.Document&nbsp;'Отдельный&nbsp;документ</p><p class='t'>Dim&nbsp;stnObj&nbsp;As&nbsp;Visio.Document&nbsp;'&nbsp;Трафарет&nbsp;(Stencil)</p><p class='t'>Dim&nbsp;mastObj&nbsp;As&nbsp;Visio.Master&nbsp;'&nbsp;Мастер-шейп,&nbsp;который&nbsp;будет&nbsp;перетаскиваться&nbsp;на&nbsp;рисунок</p><p class='t'>Dim&nbsp;pagsObj&nbsp;As&nbsp;Visio.Pages&nbsp;'Коллекция&nbsp;страниц&nbsp;в&nbsp;документе</p><p class='t'>Dim&nbsp;pagObj&nbsp;As&nbsp;Visio.Page&nbsp;'Отдельная&nbsp;страница</p><p class='t'>Dim&nbsp;shpObj&nbsp;As&nbsp;Visio.Shape&nbsp;'Экземпляр&nbsp;мастер-шейпа</p><p class='t'>'Создается&nbsp;экземпляр&nbsp;Visio</p><p class='t'>Set&nbsp;appVisio&nbsp;=&nbsp;CreateObject("visio.application")</p><p class='t'>Set&nbsp;docsObj&nbsp;=&nbsp;appVisio.Documents</p><p class='t'>'Создается&nbsp;документ&nbsp;на&nbsp;основе&nbsp;шаблона</p><p class='t'>Set&nbsp;docObj&nbsp;=&nbsp;docsObj.Add("Basic&nbsp;Diagram.vst")</p><p class='t'>Set&nbsp;pagsObj&nbsp;=&nbsp;appVisio.ActiveDocument.Pages</p><p class='t'>'Выбирается&nbsp;из&nbsp;коллекции&nbsp;первая&nbsp;страница&nbsp;документа</p><p class='t'>Set&nbsp;pagObj&nbsp;=&nbsp;pagsObj.Item(1)</p><p class='t'>Set&nbsp;stnObj&nbsp;=&nbsp;appVisio.Documents("Basic&nbsp;Shapes.vss")</p><p class='t'>Set&nbsp;mastObj&nbsp;=&nbsp;stnObj.Masters("Rectangle")</p><p class='t'>'Перетаскивается&nbsp;с&nbsp;трафарета&nbsp;Basic&nbsp;Shapes.vss&nbsp;шейп&nbsp;Rectangle</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;pagObj.Drop(mastObj,&nbsp;4.25,&nbsp;5.5)</p><p class='t'>'и&nbsp;в&nbsp;нем&nbsp;пишется&nbsp;текст</p><p class='t'>shpObj.Text&nbsp;=&nbsp;"Hello&nbsp;World!"</p><p class='t'>'сохраняется&nbsp;полученный&nbsp;документ</p><p class='t'>docObj.SaveAs&nbsp;"hello.vsd"</p><p class='t'>MsgBox&nbsp;"Нарисовано!",&nbsp;,&nbsp;"Hello&nbsp;World!"</p><p class='t'>'Закрывается&nbsp;Visio</p><p class='t'>appVisio.Quit</p><p class='t'>End&nbsp;Sub</p><p class='t'>&nbsp;</p>
<p class='n' id='a172'>Как сохранить документ в формате .htm?</p>
<p class='v'> .SaveAs (...htm) пишет неправильно.</p>
<p class='o'>Существует метод Export, с помощью которого все делается.</p><p class='o'>Вот информация из Хелпа. Метод Export экспортирует объект Visio в файлы таких форматов как .pcx, .eps, или .htm.</p><p class='o'>Синтаксис object.Export fileName.</p><p class='o'>Object - выражение, возвращающее экспортируемый объект Page, Master, Selection, или Shape.</p><p class='o'>FileName - полный путь и имя файла для сохранения экспортируемого объекта.</p><p class='o'>Примечание. Тип преобразования при экспорте определяется расширением файла. Если соответствующий фильтр не установлен, метод Export возвращает ошибку.</p><p class='o'>Метод использует установки "по умолчанию" соответствующего фильтра и не принимает дополнительных аргументов.</p><p class='o'>Метод Export, примененный к странице (Page), поддерживает сохранение ее в файле HTML формата с расширением .htm или .html. Страница экспортируется с установками, использованными последний раз при выполнении диалога Save As.</p><p class='o'>Если заданный файл уже существует, он перезаписывается без дополнительных подтверждений.</p><p class='o'>Дополнение. Export обязательно требует полный путь.</p><p class='o'>Вот это у  меня работает: pagObj.Export "g:\hello.htm"</p>
<p class='n' id='a173'>Не могу передать строку в .Cells("User....")</p>
<p class='v'>Не могу передать строку в .Cells("User....") (Цифры пишет а строку нет).</p>
<p class='o'>Строка передается с тремя кавычками, типа вот так:</p><p class='o'>shpObj.Cells("Prop.ttr.Label").Formula = """Текстовая строка""".</p>
<p class='n' id='a174'>Как в VB работать с группой?</p>
<p class='v'>Подскажите пожалуйста, как в VB работать с группой? Я создал группу:</p><p class='v'>ActiveWindow.Select shp1Obj, visSelect</p><p class='v'>ActiveWindow.Select shp2Obj, visSelect</p><p class='v'>ActiveWindow.Group</p><p class='v'>А как этой группе присвоить имя, чтобы можно было менять размер, положение и т.п.?</p>
<p class='o'>Образовавшаяся группа сама является шейпом, имеет имя и т.д.</p><p class='o'>Один из способов узнать имя - воспользоваться тем, что после команды Group группа выбрана и выбрана только эта группа. То есть MsgBox ActiveWindow.Selection.Item(1).Name покажет вам ее имя.</p>
<p class='n' id='a175'>Как VB закрасить прямоугольник?</p>
<p class='v'> Подскажите, как VB нарисовать прямоугольник и закрасить его, допустим, красным цветом.</p><p class='v'>MyObj = ActivePage.DrawRectangle(5, 5, 6, 6) а дальше?</p>
<p class='o'>Нажимаете Format/Fill/Color. Видите, слева красного цвета стоит цифра 2. Это номер цвета в палитре Visio. Красить шейпы можно цветами из палитры от 0 до 23 (туда можно включать и свои цвета).</p><p class='o'>Делается это так:</p><p class='o'> Рисуем шейп прямоугольник</p><p class='o'>Set MyObj = ActivePage.DrawRectangle(5, 5, 6, 6)</p><p class='o'> Определяем ячейку, отвечающую за цвет</p><p class='o'>Set cellObj = MyObj.Cells("FillForegnd")</p><p class='o'> Говорим, что шейп должен быть красным</p><p class='o'>cellObj.Formula = 2</p><p class='o'>Вместо прямого указания индекса палитры можно использовать функцию rgb(), например rgb(255, 0, 0) возвратит индекс красного цвета.</p><p class='o'>cellObj.Formula = "RGB(255; 0; 127)"</p><p class='o'>Путем определения в документе пользовательских цветов можно нарастить палитру еще на 232 цвета, но при этом нужно быть осторожным при переносе шейпов из одного документа в другой (при некорректной работе могут перекраситься).</p>
<p class='n' id='a176'>Как можно вставить Visio в Word?</p>
<p class='v'>Есть документ в ворде и документ в визио (страниц много). В ворде делаю ThisDocument.Shapes.AddOLEObject "Visio.Drawing", File_vsd, , , , , , 75, 75, 400, 450, Selection.Range</p><p class='v'>Но это только первая страница, а нужно вставить в Word страницы из Visio одна за другой(не обязательно в том же порядке, как в Visio), под рисунок написать: Рис. "N"-i "appVisio.ActiveDocument.Pages.Item(i)" , за ней следующую и т.д.</p>
<p class='o'>Вставляя OLE объект из файла Вы вставляете весь многостраничный документ, а не только первую страницу. Тем более, что вставляется не первая страница, а та, на которой был закрыт документ Visio, например, последняя или пятая. Если сделать ту же операцию вручную из меню Word, то во вставленном объекте можно переходить с одной страницы на другую. Можно вставить объект два раза в разные места, а потом в одном из них перейти на другую страницу, и в Word'е Вы увидите две разные картинки. Если Вы хотите вставить несколько объектов, отображающих по умолчанию разные страницы рисунка Visio, то это будут просто копии одного и того же объекта, но открытые на разных страницах.</p><p class='o'>Как иллюстрация работает такой вариант:</p><p class='o'>Документ Visio был сохранен на третьей странице. Программка делает следующее:</p><p class='o'>вставляет третью страницу (первый AddOle), перелистывает файл на первую страницу,</p><p class='o'>вставляет первую страницу (второй AddOle).</p>
<p class='t'>&nbsp;ActiveDocument.InlineShapes.AddOLEObject&nbsp;_</p><p class='t'>	ClassType:="Visio.Drawing",&nbsp;DisplayAsIcon:=False,&nbsp;_</p><p class='t'>	FileName:="g:\Business\MP\Orders\importer.vsd",&nbsp;_</p><p class='t'>	Range:=ActiveDocument.Paragraphs(2).Range</p><p class='t'>On&nbsp;Error&nbsp;Resume&nbsp;Next</p><p class='t'>Dim&nbsp;appObj&nbsp;As&nbsp;Visio.Application</p><p class='t'>Set&nbsp;appObj&nbsp;=&nbsp;CreateObject("Visio.Application")</p><p class='t'>If&nbsp;appObj&nbsp;Is&nbsp;Nothing&nbsp;Then</p><p class='t'>&nbsp;MsgBox&nbsp;"Failed&nbsp;creating&nbsp;Visio&nbsp;instance."</p><p class='t'>Else</p><p class='t'>'&nbsp;MsgBox&nbsp;"ProcessID:&nbsp;"&nbsp;&&nbsp;appObj.ProcessID</p><p class='t'>'&nbsp;appObj.Visible&nbsp;=&nbsp;True</p><p class='t'>End&nbsp;If</p><p class='t'>&nbsp;Set&nbsp;docsObj&nbsp;=&nbsp;appObj.Documents.Open("g:\Business\MP\Orders\importer.vsd")</p><p class='t'>&nbsp;Set&nbsp;pagsObj&nbsp;=&nbsp;docsObj.Pages</p><p class='t'>&nbsp;appObj.ActiveWindow.Page&nbsp;=&nbsp;"Page-1"</p><p class='t'>&nbsp;appObj.ActiveDocument.Save</p><p class='t'>&nbsp;appObj.Quit</p><p class='t'>&nbsp;&nbsp;ActiveDocument.InlineShapes.AddOLEObject&nbsp;_</p><p class='t'>	ClassType:="Visio.Drawing",&nbsp;DisplayAsIcon:=False,&nbsp;_</p><p class='t'>	FileName:="g:\Business\MP\Orders\importer.vsd",&nbsp;_</p><p class='t'>	Range:=ActiveDocument.Paragraphs(3).Range</p>
<p class='o'>Возможен и другой вариант - вставлять объекты не из файла, а открыть приложение Visio, не закрывая листать его и передавать объекты через Clipboard.</p>
<p class='n' id='a177'>Как программно отформатировать текст в шейпе?</p>
<p class='v'>Как программно отформатировать текст в шейпе используя несколько шрифтов?</p>
<p class='o'>Все параметры шейпов в Visio отображаются и меняются в шейп-листе (ShapeSheet).</p><p class='o'>Если не знаете, как сделать что-то программно, делайте это вручную и смотрите, как это отражается в шейп-листе. Потом пытайтесь внести такое же изменение в ячейку шейп-листа программно.</p><p class='o'>Например.</p><p class='o'>Рисуем на листе только один квадрат, пишем в нем 1234567890. Открываем шейп лист. Находим секцию Character (на будущее). Теперь на листе рисунка красим текст в красный цвет. В шейп листе тут же в ячейке Color секции Character появляется 2 (номер красного цвета). Делаем вывод - если записать в ячейку Color значение 2, текст станет красным.</p><p class='o'>Проверяем. Отменяем ручные изменения и выполняем макрос</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>ActivePage.Shapes(1).Cells("Char.Color").Result("")&nbsp;=&nbsp;"2"</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Убеждаемся, что текст после этого макроса опять становится красным.</p><p class='o'>Точно также можно работать и с другими атрибутами секции Character: Font, Size, Scale и т.д.</p><p class='o'>Примечание.</p><p class='o'>Если в одном шейпе текст имеет разное форматирование (например 3 буквы красные, потом 5 синих), то в секции Character это будет отражено двумя строчками и можно менять параметры каждой группы текста отдельно. Больше групп - больше строчек. Однако, если первоначально текст был отформатирован одинаково (в секции была только одна строка), то возникнет проблема. В документации прямо указывается, что добавление и удаление строк из четырех секций запрещено (visSectionCharacter, visSectionParagraph, visSectionTextField, or visSectionTab).</p><p class='o'>Так что хорошо бы  заранее готовить шейпы с нужным числом строк.</p><p class='o'>Если известно, что в каком-то типе шейпа может понадобиться менять форматирование фрагмента текста - взять и подправить мастер-шейп, то-есть внести несколько строк в секцию еще на уровне мастер-шейпа. Будет специальный мастер. А на рисунке уже работать с подготовленными секциями. Вот только разметка позиций будет фиксированной. Еще один кривой вариант - работать с группой. В принципе наверно можно иметь несколько шейпов-текстовых блоков, менять их размер в зависимости от введенного текста (типа Width = GUARD(EVALTEXT(TheText)) и позиционировать один за другим. Тогда каждый будет управляться сам по себе, а выглядеть это будет как одна текстовая строка (сам не пробовал, но почему бы не работать).</p><p class='o'>Некоторые эффекты получаются с использованием ячеек Scale и Transparency. То есть фрагмент текста можно сделать невидимым и сжать, а когда нужно развернуть.</p>
<p class='n' id='a178'>Как красиво приклеить?</p>
<p class='v'>Для склеивания двух объектов Shape использую Line Connector и Connection Point:</p><p class='v'>CObj, NObj - объекты Shape, хост и сегмент</p><p class='v'>conObj - объект Line Connector</p><p class='v'>(1) conObj.Cells("BeginX").GlueTo CObj</p><p class='v'>(2) conObj.Cells("EndX").GlueTo NObj.Cells ("Connections.X1")</p><p class='v'>Часто, при переносе какого-либо из двух объектов, "Line Connector" пересекает изображение объекта, выглядит плохо.</p><p class='v'>Вручную можно "Line Connector" приклеить к Shape объекту целиком, при этом используемый "Connection Point" выбирается автоматически в соответствии с расположением Shape объектов. Как образовать такое соединение программным путём?</p>
<p class='o'>Коннектор можно клеить к:</p><p class='o'>- точкам соединения - Connections.Xn или Connections.Yn (Ваш пример)</p><p class='o'>- изломам геометрии - Geometry.Xn или Geometry.Yn</p><p class='o'>- сторонам шейпа - AlignLeft, AlignCenter, AlignRight, AlignTop, AlignMiddle или AlignBottom</p><p class='o'>- наконец, динамический клей (то, что Вам нужно) - к PinX или PinY</p><p class='o'>Типа: conObj.Cells("EndX").GlueTo NObj.Cells("PinX")</p><p class='o'>А если уж совсем хочется эффектов, то можно еще поманипулировать секцией Shape Layout для совершенстования обтекания (это аналогично вкладке Format/Behavior/Placement).</p>
<p class='n' id='a179'>Подскажите, как в VBA получить координаты шейпа</p>
<p class='v'>Подскажите, как в VBA получить координаты шейпа относительно страницы, на которой он находится?</p>
<p class='o'>Координаты шейпа относительно листа рисунка хранятся в шейп-листе данного шейпа в секции ShapeTransform в ячейках PinX и PinY. При этом под координатами шейпа понимаются координаты центра описанного прямоугольника. Доступ из VBA производится по имени ячейки .Cells("PinX") и .Cells("PinY").</p><p class='o'>Например, выражение ActivePage.Shapes(1).Cells("PinX") даст X координату первого шейпа на активной странице.</p><p class='o'>Координаты считаются от левого нижнего угла страницы в дюймах.</p>
<p class='n' id='a180'>Как выделить фигуры на слое?</p>
<p class='v'>Подскажите, как программным образом, произвести выделение определенных фигур на каком-то определенном слое.</p>
<p class='o'>Как я понимаю, делается это долго и нудно.</p><p class='o'>Селектированные шейпы являются членами коллекции Selection. (Window/Selection).</p><p class='o'>Коллекция слоев относится к странице документа Document/Page/Layers.</p><p class='o'>Привязка шейпа к слою определяется в секции Layer Membership.</p><p class='o'>Вот и получается, что нужно найти индекс нужного слоя, а потом перебирать все шейпы на странице и проверять, не относятся ли они к нужному слою. А уж если относятся, то включать их в коллекцию Selection методом Select от окна.</p><p class='o'>Типа winObj.Select shpObj,visSelect</p><p class='o'>где winObj - окно</p><p class='o'>shpObj - селектируемый шейп</p><p class='o'>visSelect - константа такая.</p><p class='o'>Чтобы другие не мешались, возможно придется также использовать visDeselect или visDeselectAll.</p><p class='o'>Да, если хочется еще и только определенные шейпы выбрать, то вдобавок нужно проверять, такой ли это шейп, например, по имени.</p>
<p class='n' id='a181'>Где взять инфу про Pinx и Piny?</p>
<p class='v'>Где взять инфу про Pinx и Piny?</p>
<p class='o'>Немножко есть прямо в Help'е, только не в основном, а в том, который открывается из окна Visual Basic. Побольше - в DVS - (Developing Visio Solutions), который чаще всего входит в комплект поставки Visio. Правда, и то и другое на английском.</p><p class='o'>Да и что о них говорить-то особо. Просто координаты центра вращения шейпа, которые сидят в секции Shape Transform.</p>
<p class='n' id='a182'>Как обратиться к шейпу по координатам?</p>
<p class='v'>Подскажите, можно ли узнать принадлежит ли точка с координатами X,Y какому-нибудь шейпу (и соответственно его имя), и принадлежит ли эта точка какой то линии в этом шейпе (если он составной из нескольких фигур (линий))?</p>
<p class='o'>Например, перебираем всю коллекцию шейпов, вычисляя для них</p><p class='o'>intRet = object.HitTest(x, y, tolerance)</p><p class='o'>где object - очередной шейп.</p><p class='o'>Как только натыкаемся на шейп, выдающий visHitOnBoundary или visHitInside, выбираем имя данного шейпа.</p>
<p class='n' id='a183'>Почему в коде нельзя присвоить CustomProp тип Row = 1?</p>
<p class='v'>Может, кто подскажет, почему в коде нельзя присвоить CustomProp тип Row = 1?</p><p class='v'>p3 = Shape.AddNamedRow(visSectionProp, "tttt", 1)</p>
<p class='o'>Почему нельзя - не могу подсказать, а вот выкрутиться вроде можно. Можно создать тип по умолчанию, а потом переопределить его</p>
<p class='t'>p3&nbsp;=&nbsp;ActivePage.Shapes(1).AddNamedRow(visSectionProp,&nbsp;"tttt",&nbsp;0)</p><p class='t'>Set&nbsp;cellObj&nbsp;=&nbsp;ActivePage.Shapes(1).Cells("Prop.tttt.Type")</p><p class='t'>cellObj.Formula&nbsp;=&nbsp;1</p>
<p class='n' id='a184'>Как перехватить events в поле Value, если произошли изменения данных?</p>
<p class='v'>Как перехватить events в поле Value, если произошли изменения данных?</p>
<p class='o'>Вот такая конструкция (после выполнения макроса ttt) срабатывает на любое изменение первого шейпа на странице и через MsgBox перечисляет все изменившиеся ячейки, в том числе и пользовательские. Остается отфильтровать их и реагировать только на нужную ячейку.</p>
<p class='t'>Dim&nbsp;WithEvents&nbsp;m_shpObj&nbsp;As&nbsp;Visio.Shape</p><p class='t'>Public&nbsp;Sub&nbsp;InitWith(ByVal&nbsp;aShape&nbsp;As&nbsp;Visio.Shape)</p><p class='t'>	Set&nbsp;m_shpObj&nbsp;=&nbsp;aShape</p><p class='t'>End&nbsp;Sub</p><p class='t'>Private&nbsp;Sub&nbsp;m_shpObj_CellChanged(ByVal&nbsp;Cell&nbsp;As&nbsp;Visio.IVCell)</p><p class='t'>	MsgBox&nbsp;Cell.Shape.Name&nbsp;&&nbsp;"&nbsp;"&nbsp;&&nbsp;Cell.Name&nbsp;&&nbsp;"&nbsp;changed&nbsp;to&nbsp;="&nbsp;&&nbsp;Cell.Formula</p><p class='t'>End&nbsp;Sub</p><p class='t'>Sub&nbsp;ttt()</p><p class='t'>Set&nbsp;m_shpObj&nbsp;=&nbsp;ActivePage.Shapes(1)</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a185'>Пример работы с текстом и файлами.</p>
<p class='v'>Я никогда не программировала для Visio и, чтобы разобраться как это делается, не поможете ли с программой для примера.</p><p class='v'>В открытом документе по указанию на какой-либо допустим квадратик (double-click?), берется его подпись (может activePage.Shapes.Text ?), открывается другой более общий файл visio, находится там квадратик с тем же текстом, увеличивается просмотр с центром экрана на этом квадратике.</p><p class='v'>Заранее спасибо.</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>&nbsp;&nbsp;s0&nbsp;=&nbsp;ActiveWindow.Selection.Item(1).Text</p><p class='t'>&nbsp;&nbsp;Dim&nbsp;docObj&nbsp;As&nbsp;Visio.Document</p><p class='t'>&nbsp;&nbsp;Dim&nbsp;selObj&nbsp;As&nbsp;Visio.Selection</p><p class='t'>&nbsp;&nbsp;Dim&nbsp;winObj&nbsp;As&nbsp;Window</p><p class='t'>&nbsp;&nbsp;Set&nbsp;docObj&nbsp;=&nbsp;Documents.Open("C:\FileБолееОбщий.vsd")</p><p class='t'>&nbsp;&nbsp;Set&nbsp;pagObj&nbsp;=&nbsp;docObj.Pages(1)</p><p class='t'>&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;pagObj.Shapes.Count</p><p class='t'>	s&nbsp;=&nbsp;pagObj.Shapes(i).Text</p><p class='t'>	If&nbsp;(InStr(s,&nbsp;s0)&nbsp;>&nbsp;0)&nbsp;Then</p><p class='t'>	&nbsp;&nbsp;Set&nbsp;winObj&nbsp;=&nbsp;ActiveWindow</p><p class='t'>	&nbsp;&nbsp;winObj.Select&nbsp;pagObj.Shapes(i),&nbsp;visSelect&nbsp;+&nbsp;visDeselectAll</p><p class='t'>	&nbsp;&nbsp;px&nbsp;=&nbsp;winObj.Selection.Item(1).Cells("PinX")</p><p class='t'>	&nbsp;&nbsp;py&nbsp;=&nbsp;winObj.Selection.Item(1).Cells("PinY")</p><p class='t'>	&nbsp;&nbsp;winObj.SetViewRect&nbsp;px&nbsp;-&nbsp;1,&nbsp;py&nbsp;+&nbsp;1,&nbsp;5,&nbsp;5</p><p class='t'>	&nbsp;&nbsp;MsgBox&nbsp;("pX=&nbsp;"&nbsp;&&nbsp;px&nbsp;&&nbsp;"&nbsp;pY=&nbsp;"&nbsp;&&nbsp;py)</p><p class='t'>	End&nbsp;If</p><p class='t'>&nbsp;&nbsp;Next</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Двойной щелчок по любому из квадратиков загружает более общий файл, находит в нем шейпы с похожим текстом и позиционирует на них окно. MsgBox пишет координаты шейпа (и тормозит программу на время просмотра).</p><p class='o'>После выполнения макроса "Более общий" файл закрыть вручную (забыл Close написать)</p>
<p class='n' id='a186'>Как можно закрепить длину линии?</p>
<p class='v'>Как можно закрепить длину линии (а координаты можно было бы менять)?</p><p class='v'>конкретно:</p><p class='v'>Надо перенести с рисунка многоугольник, у которого точно известны только длины сторон.</p><p class='v'>А может у кого-нибудь есть такой многоугольник (вручную вводится кол-во сторон и их длина, а потом на листе можно произвольно менять форму - длина сторон не меняется)</p><p class='v'>p/s прошу сильно не пинать, первый раз начал работать с Visio</p>
<p class='o'>Просто закрепить длину линии (ребра многоугольника) нельзя.</p><p class='o'>Но можно подойти с другой стороны.</p><p class='o'>Visio рисует геометрическую фигуру последовательным применением функции MoveTo(x,y). Значит если вычислить координаты x и y всех точек многоугольника так, чтобы они удовлетворяли заданным условиям (фиксированные расстояния между вершинами), то задача будет решена. Останется только вписать соответствующие формулы в ячейки секции Geometry шейп-листа и защитить их функцией Guard от изменения.</p><p class='o'>То есть задача основывается на решении математической задачи построения многоугольника по заданным длинам сторон. Надо будет только придумать, куда вставить управляемую переменную, которая будет зависеть от воздействия оператора. Например, мышкой можно будет тянуть вершину многоугольника по координате x, а координата y этой вершины и обе координаты соседней вершины (минимум одной) должны вычисляться как функции этой переменной.</p><p class='o'>Причем управляться может не одна соседняя вершина, а несколько. И тянуть можно в принципе любую вершину, что еще более запутывает вычисления.</p><p class='o'>Короче, задача в принципе разрешима, но не думаю, чтобы у кого-то был такой многоугольник.</p>
<p class='n' id='a187'>Как программно добавить трафарет (*.vss) в уже открытый документ?</p>
<p class='v'>Как программно добавить трафарет (*.vss) в уже открытый документ, чтоб он попал в группу Shapes в левой части документа. Это можно вручную сделать так:</p><p class='v'>   File->Stencils->Open Stencil</p><p class='v'>  но</p><p class='v'>Dim appVisio As Object, dc As Visio.Document</p><p class='v'>Set dc = appVisio.Documents.Add("...El.vss")</p><p class='v'>или  Set dc = appVisio.Documents.Open("...El.vss")</p><p class='v'>открывают его, но в отдельном окне, не добавленном в группу Shapes исходного документа</p>
<p class='o'>Мне кажется немного не так.</p><p class='o'>	File->Stencils->Open Stencil</p><p class='o'>ничего не добавляет в группу Shapes исходного документа. Открывается новый документ с трафаретом. Только этот трафарет, что называется docked, на первом документе. И его компоненты лежат в коллекции Masters этого второго документа.</p><p class='o'>Такой же эффект дает использование OpenEx с указанием, как открывать. Например:</p>
<p class='t'>Dim&nbsp;ds&nbsp;As&nbsp;Visio.Document</p><p class='t'>Set&nbsp;ds&nbsp;=&nbsp;Application.Documents.OpenEx("Blocks.vss",&nbsp;visOpenDocked)</p><p class='t'>MsgBox&nbsp;Documents(1).Name</p><p class='t'>MsgBox&nbsp;Documents(2).Name</p>
<p class='n' id='a188'>Как определить удаляемый шейп?</p>
<p class='v'>Некоторые проблемы при работе с событиями:</p><p class='v'>меня интересуют обработка событий работы с шейпами - добавление Events с кодом вып visActCodeRunAddon:</p><p class='v'> а)событие добавления:</p><p class='v'>   evl.Add visEvtAdd + visEvtShape, visActCodeRunAddon, "MyShp.exe", "1"</p><p class='v'>   или evl.Add &H8040, visActCodeRunAddon, "MyShp.exe", "1"</p><p class='v'>работает нормально, а вот с удалением шейпа - проблемы:</p><p class='v'>вроде есть событие BeforeShapeDelete с кодом &H4040. Оно срабатывает, но в программе-обработчике уже</p><p class='v'>	Dim dc As Visio.Window, shp As Visio.Shape, sel As Visio.Selection</p><p class='v'>	 Set app = GetObject(, "visio.application")</p><p class='v'>	 Set dc = app.ActiveWindow:  Set sel = dc.Selection</p><p class='v'>	 i = sel.Count</p><p class='v'>получаю i=0 тем самым, хотя и вроде до удаления, я не могу получить уникальный идентификатор выделенного шейпа</p><p class='v'>  IDString = shpObj.UniqueID(visGetOrMakeGUID)</p><p class='v'>события на Selection у шейпа нет, событие SelectionChanged (код 701 или &H02BD) - не отрабатывает под Visio2000.  Что делать?</p>
<p class='o'>А почему нельзя взять шейп из параметров?</p><p class='o'>Типа, вот так:</p><p class='o'>Private Sub Document_BeforeSelectionDelete(ByVal Selection As IVSelection)</p><p class='o'>MsgBox Selection(1).Name 'Печатается имя предназначенного для удаления шейпа</p><p class='o'>End Sub</p><p class='o'>И в случае Add-on тоже можно использовать параметры.</p><p class='o'>Вместо того, чтобы после вызова Add-on'а искать селектированный шейп, попробуйте отловить его непосредственно из  параметров вызова Add-on.</p><p class='o'>Например, строчка</p><p class='o'>MsgBox Command</p><p class='o'>(в запускающемся Add-on) выводит приблизительно такую строку.</p><p class='o'>/visio=4194304 /doc=1 /page=1 /shape=Sheet.1 /event=16448 /eventid=89 /args=Shape deleted!</p><p class='o'>Здесь /shape=Sheet.1 - это имя удаляемого шейпа. (/args=... - это могут быть еще и дополнительные аргументы).</p><p class='o'>Такая строка - результат события, формирующегося после</p><p class='o'>eventsObj.Add &H4040, visActCodeRunAddon, "SHOWARGS.EXE", "/args=Shape deleted!"</p><p class='o'>Вам ведь, как я понял, нужно именно отловить в Add-on удаляемый шейп?</p>
<p class='n' id='a189'>Почему срабатывает ShapeAdded при открытии файла?</p>
<p class='v'>Работая через VBasic с Visio Type Library,я пытался использовать обработчик события ShapeAdded в клиенте (объявлена переменная dim WithEvents app As Visio.Application)</p><p class='v'>Sub appVisio_ShapeAdded(ByVal Shape As Visio.IVShape)</p><p class='v'>...</p><p class='v'>End Sub</p><p class='v'>и пришел к неожиданному выводу - что он срабатывает при открытии файла *.WMF (не только при добавлении шейпов). При открытии стандартного *.VSD обработчик "молчит".</p><p class='v'>Почему это? Может Visio при чтении такого файла воспринимает процесс как добавление шейпов или недоработка?</p>
<p class='o'>При открытии стандартного vsd обработчик молчит, потому что просто открывается пустой рисунок.</p><p class='o'>При открытии WMF Visio открывает для него пустой документ, а затем помещает на него картинку (WMF). Эта картинка является тоже шейпом, у него существует шейп-лист, полный набор атрибутов и т.д. То есть срабатывание добавления шейпа вполне закономерно и соответствует правилам Visio.</p>
<p class='n' id='a190'>Как определить путь?</p>
<p class='v'>Я хочу взять элемент из трафарета. У меня на компьютере он лежит</p><p class='v'>C:\Program Files\Visio\Solutions\папкастрафаретами  ,</p><p class='v'>а у соседа чего-то там Visio10/1033/ и вообще какой-то другой путь.</p><p class='v'>Если я напишу</p><p class='v'>Set stnObj = appVisio.Documents.Open(appVisio.Path &</p><p class='v'>"\Solutions\centel\adress_узел.vss"), то соседний компьютер все равно не поймет, у него же между программной директорией и папкой Solutions лежит еще папка 1033.</p><p class='v'>Нельзя ли как-то указать на папку Solutions вне зависимости от версии Visio?</p>
<p class='o'>У объекта Application существуют свойства:</p><p class='o'>AddonPaths, StartupPaths, DrawingPaths, StencilPaths, FilterPaths, TemplatePaths, and HelpPaths.</p><p class='o'>В данном случае следует использовать</p><p class='o'>Set stnObj = appVisio.Documents.Open(appVisio.StencilPaths &</p><p class='o'>"\centel\adress_узел.vss")</p>
<p class='n' id='a191'>Как задать требуемый номер и свойства элемента?</p>
<p class='v'>Подскажите пожалуйста, как задать требуемый (а не присваиваемый) номер и свойства элемента (узел и ветви графа), и как затем организовать ссылку в проекте VBA на эти данные. (где это все хранится?)</p>
<p class='o'>Номер (а точнее имя, которое может включать и номер) задать нельзя. Это делается только автоматикой. А для своей идентификации можно использовать поля данных, пользовательские свойства, текстовое поле, вводить дополнительные поля и т.д.</p><p class='o'>Каждому элементу (шейпу) уже сопоставлен большой массив данных (типа электронной таблицы). Там в ячейках определены геометрия, шрифты, цвета и т.д. Туда же можно добавлять и ячейки пользовательских свойств.</p><p class='o'>Некоторые мастер-шейпы на трафаретах уже имеют поля для пользовательских свойств, открываемые по Shape / Custop Properties. Если при этом пишут No custom properties exist, то можно нажать OK и здесь же определить эти свойства, а затем и ввести в них значения.</p>
<p class='v'>"как затем организовать ссылку в проекте VBA"?</p>
<p class='o'>Все шейпы на рисунке собраны в коллекцию. Просматривая эту коллекцию, можно найти нужный шейп (по имени или каким-то свойствам). Свойства доступны через ячейки шейп-листа (уже упомянутая таблица). Для выхода на эти ячейки существуют либо константы для указания секции, строки, ячейки в строке, либо некоторые ячейки имеют уникальные имена.</p>
<p class='n' id='a192'>Как программно извлечь все свойства шейпа?</p>
<p class='v'>Как программно извлечь все свойства шейпа (имеется в виду Properties которые можно вызвать через контекстное меню на правый клик). Конкретно нужно извлечь свойства UML шейпов</p>
<p class='o'>Вот программка, выбирающая значения свойств Part_Number, Manufacturer и Cost. У Вас свойства будут называться немного по-другому, но принцип тот же.</p>
<p class='t'>Private&nbsp;Sub&nbsp;Document_DocumentSaved(ByVal&nbsp;doc&nbsp;As&nbsp;IVDocument)</p><p class='t'>Dim&nbsp;pagObj&nbsp;As&nbsp;Visio.Page&nbsp;'Visio&nbsp;Page&nbsp;Object</p><p class='t'>Dim&nbsp;shpsObj&nbsp;As&nbsp;Visio.Shapes&nbsp;'Visio&nbsp;Shapes&nbsp;collection</p><p class='t'>Dim&nbsp;shpObj&nbsp;As&nbsp;Visio.Shape&nbsp;'Visio&nbsp;Shape&nbsp;object</p><p class='t'>Dim&nbsp;celObj&nbsp;As&nbsp;Visio.Cell&nbsp;'Visio&nbsp;Cell&nbsp;object</p><p class='t'>Dim&nbsp;OrderInfo()&nbsp;As&nbsp;String&nbsp;'Array&nbsp;to&nbsp;hold&nbsp;Purchase&nbsp;Order&nbsp;Info</p><p class='t'>Dim&nbsp;iShapeCount&nbsp;As&nbsp;Integer&nbsp;'Counter</p><p class='t'>Dim&nbsp;i&nbsp;As&nbsp;Integer'Counter</p><p class='t'>Set&nbsp;pagObj&nbsp;=&nbsp;ActivePage&nbsp;'Get&nbsp;the&nbsp;active&nbsp;page</p><p class='t'>Set&nbsp;shpsObj&nbsp;=&nbsp;pagObj.Shapes&nbsp;'Get&nbsp;the&nbsp;Shapes&nbsp;collection&nbsp;of&nbsp;the&nbsp;page</p><p class='t'>IshapeCount&nbsp;=&nbsp;shpsObj.Count&nbsp;'Total&nbsp;number&nbsp;of&nbsp;shapes</p><p class='t'>'Set&nbsp;the&nbsp;array&nbsp;size&nbsp;to&nbsp;hold&nbsp;all&nbsp;of&nbsp;the&nbsp;shape&nbsp;information</p><p class='t'>'0&nbsp;based&nbsp;array,&nbsp;4&nbsp;by&nbsp;total&nbsp;#&nbsp;of&nbsp;shapes</p><p class='t'>ReDim&nbsp;OrderInfo(3,&nbsp;iShapeCount&nbsp;-&nbsp;1)</p><p class='t'>'For&nbsp;each&nbsp;shape&nbsp;on&nbsp;the&nbsp;page,&nbsp;collect&nbsp;the&nbsp;Name,&nbsp;Part&nbsp;Number</p><p class='t'>'Manufacturer,&nbsp;and&nbsp;Cost</p><p class='t'>For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;iShapeCount</p><p class='t'>'Get&nbsp;the&nbsp;i'th&nbsp;shape</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;shpsObj(i)</p><p class='t'>'Get&nbsp;the&nbsp;shape&nbsp;name</p><p class='t'>OrderInfo(0,&nbsp;i&nbsp;-&nbsp;1)&nbsp;=&nbsp;shpObj.Name</p><p class='t'>'Get&nbsp;the&nbsp;Part&nbsp;Number&nbsp;Property,&nbsp;then&nbsp;get&nbsp;the&nbsp;value&nbsp;as&nbsp;a&nbsp;string</p><p class='t'>If&nbsp;shpObj.CellExists("Prop.Part_Number",&nbsp;visExistsLocally)&nbsp;Then</p><p class='t'>Set&nbsp;celObj&nbsp;=&nbsp;shpObj.Cells("Prop.Part_Number")</p><p class='t'>OrderInfo(1,&nbsp;i&nbsp;-&nbsp;1)&nbsp;=&nbsp;celObj.ResultStr("")</p><p class='t'>End&nbsp;If</p><p class='t'>'Get&nbsp;the&nbsp;Manufacturer&nbsp;Property,&nbsp;then&nbsp;get&nbsp;the&nbsp;value&nbsp;as&nbsp;a&nbsp;string</p><p class='t'>If&nbsp;shpObj.CellExists("Prop.Manufacturer",&nbsp;visExistsLocally)&nbsp;Then</p><p class='t'>Set&nbsp;celObj&nbsp;=&nbsp;shpObj.Cells("Prop.Manufacturer")</p><p class='t'>OrderInfo(2,&nbsp;i&nbsp;-&nbsp;1)&nbsp;=&nbsp;celObj.ResultStr("")</p><p class='t'>End&nbsp;If</p><p class='t'>'Get&nbsp;the&nbsp;Cost&nbsp;Property,&nbsp;then&nbsp;get&nbsp;the&nbsp;value</p><p class='t'>If&nbsp;shpObj.CellExists("Prop.Cost",&nbsp;visExistsLocally)&nbsp;Then</p><p class='t'>Set&nbsp;celObj&nbsp;=&nbsp;shpObj.Cells("Prop.Cost")</p><p class='t'>OrderInfo(3,&nbsp;i&nbsp;-&nbsp;1)&nbsp;=&nbsp;celObj.ResultIU</p><p class='t'>End&nbsp;If</p><p class='t'>'Release&nbsp;Shape&nbsp;object</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;Nothing</p><p class='t'>Next</p><p class='t'>'Print&nbsp;to&nbsp;Immediate&nbsp;window&nbsp;to&nbsp;verify&nbsp;data&nbsp;collection</p><p class='t'>For&nbsp;i&nbsp;=&nbsp;0&nbsp;To&nbsp;pagObj.Shapes.Count&nbsp;-&nbsp;1</p><p class='t'>Debug.Print&nbsp;OrderInfo(0,&nbsp;i)&nbsp;&&nbsp;","&nbsp;_</p><p class='t'>&&nbsp;OrderInfo(1,&nbsp;i)&nbsp;&&nbsp;","&nbsp;_</p><p class='t'>&&nbsp;OrderInfo(2,&nbsp;i)&nbsp;&&nbsp;","&nbsp;_</p><p class='t'>&&nbsp;OrderInfo(3,&nbsp;i)</p><p class='t'>Next</p><p class='t'>'Call&nbsp;a&nbsp;function&nbsp;to&nbsp;write&nbsp;data&nbsp;out&nbsp;to&nbsp;any&nbsp;external</p><p class='t'>'data&nbsp;storage,&nbsp;pass&nbsp;the&nbsp;array&nbsp;of&nbsp;collected&nbsp;data</p><p class='t'>'ExportData&nbsp;OrderInfo</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a193'>Как программно добраться до свойств шейпа (Properties)?</p>
<p class='v'>Как программно добраться до свойств шейпа (Properties)? В Cells их не видно. Например, у шейпа Class есть много свойств (Attributes, Operations) - там довольно большой уровень вложенности и их нигде не видно</p>
<p class='o'>Начинаем исследования.</p><p class='o'>Создаем рисунок UML и бросаем всего один шейп Class (о нем шла речь в примере).</p><p class='o'>Нажимаем View / Drawing Explorer Window и раскрываем в дереве Foregorund Pages. Видим последовательно вложенные Static Structure-1, Shapes, Class. Это наш первый шейп Class на рисунке. Пытаемся раскрыть дальше и видим, что в нем появляются еще Shapes и целая линейка из 8 шейпов. Вот они наши Attributes, Parameters и т.д.</p><p class='o'>Вывод - Class представляется вроде как группой из восьми шейпов, каждый из которых несет свою информацию. Как несет - пока не видно.</p><p class='o'>Чтобы было, что искать, задаем пару атрибутов. Например attribute1 : Short и attribute2 : bool.</p><p class='o'>Сохраняем рисунок в виде XML, открываем в текстовом редакторе и даем поиск "attribute1". Ну, вот оно и проявилось - -attribute1 : Short -attribute2 : bool.</p><p class='o'>То есть искомые атрибуты хранятся внутри группы в шейпе Attributes в виде обычного текста.</p><p class='o'>Проверяем из VBA:</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>MsgBox&nbsp;ActivePage.Shapes(1).Shapes.Count</p><p class='t'>MsgBox&nbsp;ActivePage.Shapes(1).Shapes(6).Name</p><p class='t'>MsgBox&nbsp;ActivePage.Shapes(1).Shapes(6).Text</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Видим последовательно:</p><p class='o'>8 - (число шейпов в группе)</p><p class='o'>Attributes - (шестой шейп - этот как раз шейп Attributes)</p><p class='o'>attribute1 : Short</p><p class='o'>attribute2 : bool</p><p class='o'>А это значения атрибутов, которые мы и ожидали увидеть.</p><p class='o'>Все (вкратце)</p>
<p class='n' id='a194'>Подскажите, можно ли отловить изменение шейпа?</p>
<p class='v'>Подскажите, можно ли отловить изменение шейпа? Дело в том, что необходимо написать процедуру, запрещающую некоторые изменения шейпов. Стандартной функции нет (есть только при добавлении шейпа ShapeAdded или при изменении текста шейпа, а необходимо отловить изменение геометрии шейпа).</p>
<p class='o'>На изменение геометрии срабатывает EventXFMod.</p><p class='o'>Что-нибудь типа Shape.Cells("EventXFMod").Formula = "RUNADDON (""ThisDocument.ttt"")" позволит в дальнейшем при изменении геометрии шейпа выходить на макрос ttt.</p>
<p class='n' id='a195'>Как формировать список выбора в пользовательском поле?</p>
<p class='v'>Необходимо формировать список выбора в пользовательском поле Shape из поля базы данных. Скажите, пожалуйста, как это сделать?</p>
<p class='o'>Тип поля должен быть установлен, например, в Fixed List, а в ячейку Format нужно подсунуть данные, выбранные из базы. Например, ="12;13;14" будет давать для выбора список из трех величин.</p>
<p class='n' id='a196'>Как формировать список выбора по данным из базы?</p>
<p class='v'>Есть база данных по вентиляторам. Сложность в том, что заранее не известно какие вентиляторы есть в базе. Тип вентилятора в списке выбора должен формироваться динамически, как только фигура вентилятора кладется на рабочий лист.</p>
<p class='o'>В обработчике события ShapeAdded коннектитесь к базе, выбираете список вентиляторов, формируете из типов вентиляторов текстовую строку (не "12;13;14", а "ВПГ-56-380; ПВ-250" или что там будет в базе) и эту строку засовываете в ячейку Format в секции пользовательских свойств в нужную строку. Лучше, если соответствующее свойство в мастер-шейпе уже есть - тогда надо только подсунуть значение в одну ячейку.</p><p class='o'>То есть, как только Вы бросите шейп на лист, в нем уже появится сформированный список из базы. Далее уже ручками открываете свойства и выбираете нужную позицию.</p>
<p class='n' id='a197'>Где описывать обработчик ShapeAdded и как его вызывать?</p>
<p class='v'>Где описывать обработчик ShapeAdded и как его вызывать?</p>
<p class='o'>Обработчик будет вызываться сам, как только на страницу упадет шейп.</p><p class='o'>Чтобы его описать, нужно вызвать Microsoft Visual Basic (Tools / Macros / Visual Basic Editor), щелкнуть слева по ThisDocument, справа в списке объектов выбрать Document, а еще правее в списке событий выбрать ShapeAdded.</p><p class='o'>При этом на листе появится заготовка типа:</p>
<p class='t'>Private&nbsp;Sub&nbsp;Document_ShapeAdded(ByVal&nbsp;Shape&nbsp;As&nbsp;IVShape)</p><p class='t'>…</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Впишите туда для проверки MsgBox, например:</p>
<p class='t'>Private&nbsp;Sub&nbsp;Document_ShapeAdded(ByVal&nbsp;Shape&nbsp;As&nbsp;IVShape)</p><p class='t'>MsgBox&nbsp;"Ой,&nbsp;Добавилось!"</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Теперь возвращайтесь на страницу рисунка и добавьте любой шейп или просто проведите линию и наблюдайте, как срабатывает Ваш обработчик.</p>
<p class='n' id='a198'>Как задать программно формату ячейки форматную строку?</p>
<p class='v'>Предположим, есть процедура</p><p class='v'>Private Sub Document_ShapeAdded(ByVal Shape As IVShape)</p><p class='v'>nam = Shape.Name</p><p class='v'>If InStr(1, nam, "Вентилятор") > 0 Then</p><p class='v'>formatstroka = "ВОМД-24;ВОМ-18"</p><p class='v'>' здесь надо задать формат в соответствии с форматной строкой</p><p class='v'>End If</p><p class='v'>End Sub</p><p class='v'>Как задать программно формату ячейки форматную строку?</p>
<p class='o'>Пусть в трафарете имеется мастер-шейп, в котором определено пользовательское свойство: Label = Typ; Type = Fixed List (другие аргументы, в том числе и формат, не заполнены).</p><p class='o'>Тогда при премещении этого мастер-шейпа на лист (срабатывает данный обработчик) нужно будет в ячейку Format записать "ВОМД-24;ВОМ-18".</p><p class='o'>Если бы данные брались не из базы, а просто как текстовая константа, это делалось бы так:</p><p class='o'>Shape.Сells("prop.row_1.Format").Formula = """ВОМД-24;ВОМ-18"""</p><p class='o'>В Вашем же случае вместо константы в тройных кавычках нужно будет подсунуть строку, сформированную из всех возможных значений, полученных из базы.</p><p class='o'>Ну и, понятно, если пользовательских свойств несколько, то вместо prop.row_1 должна быть указана нужная строка.</p>
<p class='n' id='a199'>Как назначить свойство ActivePage программным образом?</p>
<p class='v'>Кто знает, как назначить свойство ActivePage программным образом, так чтобы эта страница стала активной ?</p><p class='v'>Например, как в Excel:</p><p class='v'>Sheets("Лист2").Select</p>
<p class='o'>Скорее всего вот так:</p>
<p class='t'>(Dim&nbsp;appObj&nbsp;As&nbsp;Visio.Application)</p><p class='t'>appObj.ActiveWindow.Page&nbsp;=&nbsp;"Page-1"</p>
<p class='n' id='a200'>Как извлечь свойства нестандартных шейпов?</p>
<p class='v'>На странице много нестандартных шейпов с кучей Custom Properties.</p><p class='v'>Возможно ли программно извлечь их названия и значения? Они неизвестны на этапе проектирования.</p>
<p class='o'>Возможно.</p><p class='o'>Нужно использовать адресацию по индексам и проверку на CellsSRCExists</p><p class='o'>Примерно так:</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>iShapeCount&nbsp;=&nbsp;ActivePage.Shapes.Count</p><p class='t'>s&nbsp;=&nbsp;""</p><p class='t'>For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;iShapeCount</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;ActivePage.Shapes(i)</p><p class='t'>s&nbsp;=&nbsp;s&nbsp;&&nbsp;shpObj.Name&nbsp;&&nbsp;"&nbsp;-->&nbsp;"</p><p class='t'>'visCustPropsLabel&nbsp;&nbsp;visCustPropsPrompt</p><p class='t'>'visCustPropsSortKey	visCustPropsType</p><p class='t'>'visCustPropsFormat&nbsp;visCustPropsValue</p><p class='t'>'visCustPropsInvis&nbsp;&nbsp;visCustPropsAsk</p><p class='t'>For&nbsp;j&nbsp;=&nbsp;0&nbsp;To&nbsp;7</p><p class='t'>&nbsp;If&nbsp;shpObj.CellsSRCExists(visSectionProp,&nbsp;visRowProp&nbsp;+&nbsp;j,&nbsp;visCustPropsLabel,&nbsp;True)&nbsp;Then</p><p class='t'>&nbsp;&nbsp;Set&nbsp;CellObj&nbsp;=&nbsp;shpObj.CellsSRC(visSectionProp,&nbsp;visRowProp&nbsp;+&nbsp;j,&nbsp;visCustPropsLabel)</p><p class='t'>&nbsp;&nbsp;s&nbsp;=&nbsp;s&nbsp;&&nbsp;CellObj.ResultStr(0)</p><p class='t'>&nbsp;&nbsp;Set&nbsp;CellObj&nbsp;=&nbsp;Nothing</p><p class='t'>&nbsp;End&nbsp;If</p><p class='t'>Next</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;Nothing</p><p class='t'>Next</p><p class='t'>MsgBox&nbsp;s</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a201'>Как из VISIO связывать Recordset с таблицей в базе данных?</p>
<p class='v'>Как из VISIO связывать datPrimaryRS с таблицей в базе данных?</p><p class='v'>База данных ACCESS</p>
<p class='o'>Да так же, как и из любого приложения на VBA. Например, через ADODB. Вот здесь datPrimaryRS связывается с таблицей tabl1 в базе db1.mdb, лежащей в C:\temp, и выбирает из нее поля название и характеристика из всех записей:</p>
<p class='t'>Private&nbsp;Sub&nbsp;Document_ShapeAdded(ByVal&nbsp;Shape&nbsp;As&nbsp;IVShape)</p><p class='t'>&nbsp;Dim&nbsp;cnn&nbsp;As&nbsp;New&nbsp;ADODB.Connection</p><p class='t'>&nbsp;cnn.Open&nbsp;"Provider=Microsoft.Jet.OLEDB.4.0;"&nbsp;&&nbsp;_</p><p class='t'>	&nbsp;"Data&nbsp;Source=&nbsp;C:\temp\db1.mdb;"</p><p class='t'>&nbsp;Dim&nbsp;datPrimaryRS&nbsp;As&nbsp;New&nbsp;ADODB.Recordset</p><p class='t'>&nbsp;datPrimaryRS.Open&nbsp;"tabl1",&nbsp;cnn,&nbsp;adOpenKeyset,&nbsp;adLockOptimistic,&nbsp;adCmdTable</p><p class='t'>&nbsp;datPrimaryRS.MoveFirst</p><p class='t'>&nbsp;While&nbsp;Not&nbsp;datPrimaryRS.EOF</p><p class='t'>&nbsp;&nbsp;&nbsp;MsgBox&nbsp;datPrimaryRS!название&nbsp;&&nbsp;"&nbsp;"&nbsp;&&nbsp;datPrimaryRS!характеристика</p><p class='t'>&nbsp;&nbsp;&nbsp;datPrimaryRS.MoveNext</p><p class='t'>&nbsp;Wend</p><p class='t'>&nbsp;datPrimaryRS.Close</p><p class='t'>&nbsp;cnn.Close</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a202'>Возможна ли передача значений из Custom... одного объекта в Custom... другого?</p>
<p class='v'>Возможна ли передача значений из Custom... одного объекта в Custom... другого? Через ShapeSheet или помощью VBA? И еще, как сформировать ссылку на ячейку другого объекта в таблице ShapeSheet?</p>
<p class='o'>Возможна.</p><p class='o'>В VBA устанавливается нужная ячейка шейп-листа нужного объекта, затем в нее пишутся или читаются данные. Например,</p>
<p class='t'>&nbsp;&nbsp;Set&nbsp;CellObj&nbsp;=&nbsp;shpObj.CellsSRC(visSectionProp,&nbsp;visRowProp&nbsp;+&nbsp;j,&nbsp;visCustPropsValue)</p><p class='t'>&nbsp;&nbsp;s&nbsp;=&nbsp;CellObj.ResultStr(0)</p>
<p class='o'>читает значение пользовательского свойства.</p><p class='o'>В случае ссылки через Шейп-лист нужно знать имя шейпа, на который ссылаемся. Например,</p><p class='o'>формула =Sheet.1!Prop.Row_1 , записанная в ячейку Value, обеспечит перенос значения пользовательского свойства из первой строки шейпа Sheet.1 в шейп-приемник.</p>
<p class='n' id='a203'>Как в Visio сделать ссылку на число?</p>
<p class='v'>Как в Visio сделать ссылку на число. Т.е. есть одинаковое число в нескольких местах документа (адресация на монтажной схеме панели, формата А1) необходимо, чтобы при изменении в одном месте данного числа, все такие же заменились на вновь введенное.</p>
<p class='o'>Можно сделать ссылку на текст другого шейпа (один раз это число где-то придется ввести).</p><p class='o'>Например, если вставить поле Insert / Field / Custom Formula вот с таким текстом</p><p class='o'>ShapeText(Sheet.1!TheText)</p><p class='o'>то в данном шейпе всегда будет повторяться текст шейпа Sheet.1.</p>
<p class='n' id='a204'>Помогите подсчитать программно сколько в тексте на шейпе wrapped строк.</p>
<p class='v'>Помогите подсчитать программно сколько в тексте на шейпе wrapped строк.</p>
<p class='o'>Вот такая штуковина</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>s&nbsp;=&nbsp;ActivePage.Shapes(1).Text</p><p class='t'>i&nbsp;=&nbsp;1</p><p class='t'>While&nbsp;i&nbsp;>&nbsp;0</p><p class='t'>i&nbsp;=&nbsp;InStr(i,&nbsp;s,&nbsp;vbLf)&nbsp;+&nbsp;1</p><p class='t'>MsgBox&nbsp;i&nbsp;-&nbsp;1</p><p class='t'>Wend</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Вот по такому тексту шейпа</p><p class='o'>Раз строка</p><p class='o'>Два строка</p><p class='o'>Три строка</p><p class='o'>Говорит последовательно: 11, 22, 0. То есть переводы строк на 11, 22 позиции, а больше нету.</p>
<p class='n' id='a205'>Как подсчитать получившееся количество строк при заполнении шейпа текстом?</p>
<p class='v'>При добавлении текста на прямоугольник получается автоматический перенос строк(wrap) по ширине шейпа. Вопрос состоит в подсчете получившегося количества строк, независимо от нажатий  при вводе этого текста.</p>
<p class='o'>Здесь вычисления могут быть только приближенными. Существует функция, которая выдает расчетную высоту текста с учетом ограничения текстового блока по ширине и прочих параметров форматирования.</p><p class='o'>TEXTHEIGHT(shapename!TheText,maximumwidth)</p><p class='o'>В принципе, пользуясь ей и зная высоту одной строки, можно рассчитать и число строк. Только не забыть все делать в одинаковых единицах измерения и помнить, что отступы текстового блока тоже входят в высоту.</p>
<p class='n' id='a206'>Как в Visio 2002 включить автопозиционирование шаблона?</p>
<p class='v'>Как в Visio 2002 включить автопозиционирование шаблона? Т.е. чтоб при размещении на листе он автоматически вставал на одно и то же место.</p><p class='v'>(Пример - стандартный штамп для А4,А3 и т.п.)</p>
<p class='o'>Рисуешь штамп, группируешь и в ShapeSheet вносишь:</p>
<p class='t'>Width&nbsp;"=GUARD(196&nbsp;mm/ThePage!PageScale*ThePage!DrawingScale)"</p><p class='t'>Height&nbsp;"=GUARD(283&nbsp;mm/ThePage!PageScale*ThePage!DrawingScale)"</p><p class='t'>PinX&nbsp;"=GUARD(ThePage!PageWidth-(3&nbsp;mm/ThePage!PageScale*ThePage!DrawingScale))"</p><p class='t'>PinY&nbsp;"=GUARD(7&nbsp;mm/ThePage!PageScale*ThePage!DrawingScale)"</p><p class='t'>LocPinX&nbsp;"=GUARD(200&nbsp;mm/ThePage!PageScale*ThePage!DrawingScale)"</p><p class='t'>LocPinY&nbsp;"=GUARD(0)"</p>
<p class='o'>Это все справедливо для полного штампа А4. С А3, я думаю, проблем не возникнет. На сайте в примерах что-то подобное уже было...</p>
<p class='n' id='a207'>Как сослаться на шейп другого листа?</p>
<p class='v'>Здравствуйте, уважаемые!!! Помогите пожалуйста новичку! Надо чтобы при наборе текста в шейпе (любимом штампе А4 конечно же!) на одной странице он автоматически появлялся бы на других. С шейпами на одной странице я поэкспериментировал, но сослаться на шейп другого листа так и получилось. Возможно ли это сделать без макросов? Спасибо!</p>
<p class='o'>Приблизительно вот так:</p><p class='o'>=ShapeText(Pages[Page-2]!Sheet.1!TheText)</p><p class='o'>Page-2 - это имя другой страницы.</p><p class='o'>Если таких страниц (приемников) несколько, то лучше сделать фоновую страницу и копировать текст на нее. Он автоматически будет показываться на остальных, для которых эта страница назначена фоновой.</p>
<p class='n' id='a208'>Как определить в Visual Basic цепочку из соединенных шейпов?</p>
<p class='v'>Сделал схему ЛВС, рабочие места соединил с портами на патч панели и коммутаторах соединителями. Как можно определить в Visual Basic цепочку из соединенных шейпов и как можно пройти по этой цепочке.</p><p class='v'>Это надо для того, чтобы легко идентифицировать соответствующие порты в коммутаторах по выбранным рабочим местам.</p>
<p class='o'>Доступ к идентификаторам объектов связанных коннектором можно получить из самого коннектора.</p><p class='o'>Имя_коннектора.Connects.Item(i).ToCell.Shape.NameID</p><p class='o'>NameID - это идентификатор Шейпа на листе Sheet.номер</p><p class='o'>Имя трафарета, который использовался при создании, определяется ссылкой к полю Name</p><p class='o'>i - это номера соединяемых шейпов</p><p class='o'>Для того чтобы получить доступ к CustomProperties полям надо</p><p class='o'>page.Shapes.Item(i).Cells("Prop.CodeCable").Formula</p><p class='o'>Prop.CodeCable - название ячейки, отображаемое в ShapeSheet (в случае патч корда это так и выглядит), отображается название по-другому нежели в CustomProperties</p><p class='o'>Если такого пропертиса нет, то возвращается ошибка end of expected</p>
<p class='n' id='a209'>Можно ли получить доступ к Connection points шейпа из VB и удалить ненужные точки?</p>
<p class='v'>Задача:</p><p class='v'>есть мастер (прямоугольник), который имеет 10 Connection points слева и 10 справа. Во время перетаскивания мастера на документ и перехода в шейп требуется убрать лишние Connection points (что бы они были не видны и не доступны пользователю). Количество лишних Connection points определяется программой по заданному алгоритму.</p>
<p class='o'>В шейп-листе есть секция Connection Points. Для удаления Points нужно из этой секции удалить строку.</p><p class='o'>Строка в общем случае удаляется примерно так:</p>
<p class='t'>shpObj.DeleteRow&nbsp;visSectionFirstComponent&nbsp;+&nbsp;0,&nbsp;visRowVertex&nbsp;+&nbsp;3</p>
<p class='o'>Для секции Connection Points это будет выглядеть примерно так:</p>
<p class='t'>shpObj.DeleteRow&nbsp;visSectionConnectionPts+0,&nbsp;visRowConnectionPts+2</p>
<p class='o'>В примере удалится точка № 3 (из расчета 0, 1, 2, 3...).</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>ActivePage.Shapes(1).DeleteRow&nbsp;visSectionConnectionPts&nbsp;+&nbsp;0,&nbsp;visRowConnectionPts&nbsp;+&nbsp;2</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a210'>Как отследить изменение в выделении?</p>
<p class='v'>Подскажите, если не затруднит, как отследить изменение в выделении.</p><p class='v'>Пробовал так:</p><p class='v'>Private Sub ActiveWindow_SelectionChanged(ByVal Window As IVWindow)</p><p class='v'>MsgBox Time</p><p class='v'>End Sub</p><p class='v'>Но не работает.</p>
<p class='o'>А ассоциировать с реальным источником не забыли? Типа вот так:</p>
<p class='t'>Dim&nbsp;WithEvents&nbsp;tt&nbsp;As&nbsp;Visio.Window</p><p class='t'>Sub&nbsp;ttt()</p><p class='t'>Set&nbsp;tt&nbsp;=&nbsp;ActiveWindow</p><p class='t'>End&nbsp;Sub</p><p class='t'>Private&nbsp;Sub&nbsp;tt_SelectionChanged(ByVal&nbsp;Window&nbsp;As&nbsp;IVWindow)</p><p class='t'>MsgBox&nbsp;"Changed"</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>После выполнения ttt событие начинает срабатывать.</p>
<p class='n' id='a211'>Как в EventDrop (секция Events) указать предыдущий объект?</p>
<p class='v'>Добрый день!</p><p class='v'>Как сделать следующее:</p><p class='v'>1. в EventDrop (секция Events) указать предыдущий объект (т.е. шейп, который до этого бросили)?</p><p class='v'>2. как можно программно (скажем VB)? перед тем как бросить шейп на рисунок изменить у него какое-нить поле в ShapeSheet?</p>
<p class='o'>1. В EventDrop можно и не пытаться. То есть можно придумать какое-нибудь извращение через третий шейп, в котором отслеживать последний размещенный на странице шейп. Но будет куча сложностей, когда шейп бросят, потом удалят, потом бросят новый и т.д. На все случаи не рассчитаешь, так что лучше этим и не заниматься.</p><p class='o'>А вот с VBA наверное можно попробовать смотреть последний шейп в коллекции. Они вроде всегда в конец добавляются.</p><p class='o'>2. Нет никакой разницы, когда менять поле - перед тем как бросить или после того, это не заметно. Так что смело обрабатывайте событие ShapeAdded и в этом обработчике изменяйте поле.</p>
<p class='n' id='a212'>Есть ли возможность средствами VB отслеживать событие ShapeAdded?</p>
<p class='v'>А есть ли возможность средствами того же VB отслеживать это событие ShapeAdded (в VBA я знаю, как это сделать)?</p>
<p class='o'>Конечно, есть.</p><p class='o'>Если приложение VB делается по технологии COM Add-in (в Visio 2002 стала поддерживаться) то все практически так же, как и в VBA. Это нужно скачать из Microsoft Visio 2002 SDK, он подсаживается в VB6 и добавляет к нему свой пример-шаблон. То есть там уже все понятно становится.</p><p class='o'>А если технология Add-on, то посложнее. Это уже два разных приложения взаимодействуют. Пример по-моему в том же SDK есть (там еще и документация прилагается, правда на английском).</p>
<p class='n' id='a213'>Есть функция в VB, возвращающая NAME шейпа без цифр?</p>
<p class='v'>Думаю вопрос несложный для опытных пользователей. Пытаясь написать программку в VB под Visio, обнаружил что у расположеных на листе нескольких копий одного шейпа различаются имена. Например, на трафарете "реле", на листе одно имя "реле.4" другое "реле.7" и т.д. цифры меняются, в зависимости от элементов из которого состоит шейп. Программа воспринимает шейпы как разные, что мешает нормальной работе. Подскажите, можно ли поменяв настройки, убрать цифры в именах последующих, копируемых, шейпов, или может быть есть функция в VB возвращающая NAME шейпа без цифр. Спасибо за все ответы.</p>
<p class='o'>Поменяв настройки - нельзя.</p><p class='o'>Можно пользоваться ссылкой на Мастер-шейп, от которого они образованы. Его имя для всех таких шейпов будет одинаковым.</p><p class='o'>ActivePage.Shapes(i).Master.Name</p>
<p class='n' id='a214'>Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику?</p>
<p class='v'>Нужно сделать так, чтобы один из объектов группы исчезал и появлялся по двойному клику. Расскажите как.</p>
<p class='o'>Зайдите в ТаблицуФигур группы и вставьте раздел Другие свойства.</p><p class='o'>В ТаблицеФигур группы укажите следующие параметры:</p><p class='o'>EventDblClick =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))</p><p class='o'>И в фигуре, которая должна исчезнуть:</p><p class='o'>Geometry1.NoShow =Sheet.ID!Prop.Row_1.Prompt</p><p class='o'>где ID номер группы. Теперь при двойном нажатии эта фигура(ы) будет "исчезать" и "появляться".</p><p class='o'>Можно еще вот как поступить, если требуется убирать из группы группу.</p><p class='o'>1) Создать группу (как элемент будущей группы).</p><p class='o'>2) Скопировать в буфер.</p><p class='o'>3) Сделать специальную вставку Edit>Paste Special...</p><p class='o'>4) С этим новым элементом создать группу.</p><p class='o'>5) Зайдите в ТаблицуФигур группы и вставьте раздел Другие свойства.</p><p class='o'>В ТаблицеФигур группы укажите следующие параметры:</p><p class='o'>EventDblClick =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))</p><p class='o'>И в группе которая должна исчезнуть:</p><p class='o'>ImgWidth =Width*Sheet.ID!Prop.Row_1.Prompt</p><p class='o'>ImgHeight =Height*Sheet.ID!Prop.Row_1.Prompt</p><p class='o'>где ID номер группы. Теперь при двойном нажатии эта группа(ы) будет "исчезать" и "появляться".</p>
<p class='n' id='a215'>Как сделать, чтобы объект из группы исчезал и появлялся по двойному клику 2?</p>
<p class='v'>На строку IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt); 0); SETF(GetRef(Prop.Row_1.Prompt);1))</p><p class='v'>В поле EventDblClick я получаю сообщение "Error in formula". В справке 5-го Визио я не могу найти GetRef. Что это?</p>
<p class='o'>Измените =IF(Prop.Row_1.Prompt=1;SETF(GetRef(Prop.Row_1.Prompt);0);SETF(GetRef(Prop.Row_1.Prompt);1))</p><p class='o'>на</p><p class='o'>=IF(Prop.Row_1.Prompt=1;SETF("Prop.Row_1.Prompt";0);SETF("Prop.Row_1.Prompt";1))</p><p class='o'> Примечание: задача решилась так.</p><p class='o'>EventDblClick=IF(Prop.Row_1.Prompt=1;SETF("Prop.Row_1.Prompt";"0");SETF("Prop.Row_1.Prompt";"1"))</p><p class='o'>в общей группе.</p><p class='o'>В группе которая исчезает</p><p class='o'>Width=Sheet.ID!Width*1*Sheet.ID!Prop.Row_1.Prompt</p><p class='o'>Height=Sheet.ID!Height*0,7703*Sheet.ID!Prop.Row_1.Prompt</p>
<p class='n' id='a216'>Как программно можно поменять ориентацию страницы?</p>
<p class='v'>Как программно можно поменять положение страницы с "книжной" на "альбомную"?</p>
<p class='o'>Это можно сделать, изменив одновременно размеры страницы рисунка и ориентацию страницы принтера.  Например, вот так:</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>Height&nbsp;=&nbsp;ActivePage.PageSheet.Cells("PageWidth")</p><p class='t'>ActivePage.PageSheet.Cells("PageWidth")&nbsp;=&nbsp;ActivePage.PageSheet.Cells("PageHeight")</p><p class='t'>ActivePage.PageSheet.Cells("PageHeight")&nbsp;=&nbsp;Height</p><p class='t'>If&nbsp;ActiveDocument.PrintLandscape&nbsp;Then&nbsp;ActiveDocument.PrintLandscape&nbsp;=&nbsp;False&nbsp;Else&nbsp;ActiveDocument.PrintLandscape&nbsp;=&nbsp;True</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a217'>Как программно изменить размер и выравнивание шрифта в шейпе?</p>
<p class='v'>Подскажите pls как программно изменить размер и выравнивание шрифта в шейпе и как пользоваться стилями?</p><p class='v'>Пишу</p><p class='v'>Set shpObj = pagObj.DrawRectangle(2, 8, 6, 9)</p><p class='v'>shpObj.Text = "Hello World!"</p><p class='v'>shpObj.TextStyle = "Arial 24pt centered"</p><p class='v'>Ошибка: стиль задан неверно!</p>
<p class='o'>А Вы создали предварительно стиль с таким названием? Этот способ работает с уже имеющимися стилями.</p><p class='o'>Создать новый стиль и изменить шрифт - это совершенно разные вещи.</p><p class='o'>Изменить шрифт легко. Вот эти две строчки сделают размер шрифта 6 pt и выравняют параграф по центру. Для этого стилей создавать не нужно.</p>
<p class='t'>Sub&nbsp;tty()</p><p class='t'>ActivePage.Shapes(1).Cells("Char.Size").Formula&nbsp;=&nbsp;"=6&nbsp;pt."</p><p class='t'>ActivePage.Shapes(1).Cells("Para.HorzAlign")&nbsp;=&nbsp;1</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>А создавать новый стиль лучше все-таки вручную, а программно его только применять. То, что Вы пытались показать в примере, это только применение стиля.</p>
<p class='n' id='a218'>Можно ли значение кастом_пропертис использовать как номер скратч-ячейки?</p>
<p class='v'>Необходимо сделать в одном стенсиле несколько заготовок (автопозиционируемая рамка) которые различаются одним-двумя параметрами (допустим заливка, толщина линий). Можно ли в невидимый слой поместить несколько образцов, пронумеровав их 1-n, а затем в соответствии со значением кастом_пропертис выбрать соответствующий порядковый номер из другого списка?</p><p class='v'>Более конкретно: есть 7 вариантов заливок, но номерация их паттернов идет не подряд 28-30, 36-39. Можно ли значение кастом_пропертис использовать как номер скратч-ячейки? Или, если нельзя, как сделать по-другому (желательно без VBA)?</p>
<p class='o'>Пример:</p><p class='o'>Берем прямоугольник и делаем ему одно Custom Properties со значениями:</p><p class='o'>- Label - MyPattern</p><p class='o'>- Type - Fixed List</p><p class='o'>- Format - 1;2;12;22</p><p class='o'>- Value - 2</p><p class='o'>А в ячейку Fill Pattern загоняем вложенный If типа =IF(Prop.Row_1=1;2;IF(Prop.Row_1=2;3;IF(Prop.Row_1=12;4;8)))</p><p class='o'>Расшифровка:</p><p class='o'>Если пользовательское свойство = 1, назначить Pattern = 2, Иначе следующий If</p><p class='o'>Если пользовательское свойство = 2, назначить Pattern = 3, Иначе следующий If</p><p class='o'>Если пользовательское свойство = 12, назначить Pattern = 4, Иначе назанчить Pattern = 8</p><p class='o'>То есть значения одного списка перекодируются в значения другого списка. В Custom Properties выбираются значения из 1, 2, 12, 22, а Pattern получается соответственно 2, 3, 4, 8.</p>
<p class='n' id='a219'>Можно ли значение кастом_пропертис использовать как номер скратч-ячейки 2?</p>
<p class='v'>Меня интересует более общий подход, можно ли элемент списка 1,2,3,...,n (fixed type в custom properties) использовать как параметр ссылки, например на строку user.row_n.</p>
<p class='o'>:) Элементарно!</p><p class='o'>Делаем Format попроще - 1;2;3;4</p><p class='o'>Именуем 4 ячейки в User тоже 1, 2, 3, 4 - Это не обязательно, просто ссылаться на User.1 проще, чем на User.row_1.</p><p class='o'>В User прописываем, например, str1, str2, str3, str4.</p><p class='o'>А в Scratch всовываем вообще страшную штуку - =GUARD(SETF(GetRef(Fields.Value);"=User."&Prop.Row_1))</p><p class='o'>Теперь, выбирая значения Custom Properties, мы видим, как в текстовом поле шейпа появляется текст str1, str2 и т.д., который записан в разных ячейках User.</p>
<p class='n' id='a220'>Как из Visio из процедуры на VBA получить доступ к листу в книге Excel?</p>
<p class='v'>Как из Visio из процедуры на VBA получить доступ к листу в книге Excel?</p><p class='v'>Так же интересует обратная проблема</p>
<p class='o'>Генерация файла Excel из Визио</p>
<p class='t'>Sub&nbsp;ReadExcel()</p><p class='t'>Dim&nbsp;ExcelObject&nbsp;As&nbsp;Object</p><p class='t'>Set&nbsp;ExcelObject&nbsp;=&nbsp;CreateObject("Excel.Application")</p><p class='t'>ExcelObject.Workbooks.Add&nbsp;'&nbsp;Добавляем&nbsp;новую&nbsp;книгу</p><p class='t'>ExcelObject.Workbooks.Open&nbsp;FileName:="C:\Work\Opis.xls"&nbsp;'&nbsp;Открываем&nbsp;файл</p><p class='t'>ExcelObject.Visible&nbsp;=&nbsp;True&nbsp;'&nbsp;делаем&nbsp;excel&nbsp;видимым</p><p class='t'>ExcelObject.Range("A1",&nbsp;"A1").Value&nbsp;=&nbsp;"Test:"</p><p class='t'>ExcelObject.Range("A1",&nbsp;"A1").HorizontalAlignment&nbsp;=&nbsp;1</p><p class='t'>ExcelObject.Range("A1",&nbsp;"A1").VerticalAlignment&nbsp;=&nbsp;2</p><p class='t'>ExcelObject.Range("A1",&nbsp;"A1").WrapText&nbsp;=&nbsp;1</p><p class='t'>'&nbsp;ExcelObject.Quit&nbsp;'&nbsp;для&nbsp;закрытия&nbsp;excel</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>Соответственно можно только открыть какой-то файл или только создать пустую книгу. Остальные команды и форматы записи управления Excelем можно узнать используя запись макросов в самом Excel, а затем посмотрев текст в редакторе VBA.</p>
<p class='n' id='a221'>Как менять несколько надписей сразу?</p>
<p class='v'>Требуется, чтобы при изменении одного текста на листе менялось также несколько надписей. Нашел почти подходящий шейп в Organization Chart (Position и др.), но он, при помощи метода create synchronized copy создает связанные предметы только для разных листов. Можно ли этот метод как-то использовать для простых объектов?</p><p class='v'>Заранее спасибо.</p>
<p class='o'>А может попроще?</p><p class='o'>Вставить в зависимые шейпы поле вот с такой формулой (в данном случае ссылка на шейп Sheet.1). И то, что появится в Sheet.1, будет транслироваться в эти шейпы.</p><p class='o'>=ShapeText(Sheet.1!TheText)</p>
<p class='n' id='a222'>Как менять несколько надписей сразу 2?</p>
<p class='v'>1.Создаю прямоугольник с текстом внутри.</p><p class='v'>(тут вопросы: Нужно ли его помещать в shapes и если да то для мастера менять свойства? Дальше куда - в custom properties в format или открыть shape list? куда эту формулу =ShapeText(Sheet.1!TheText) вставлять)</p><p class='v'>2.Копирую его по всему листу(документу) и хочу, что бы при изменении текста внутри любого (можно одного главного) везде текст также менялся.</p>
<p class='o'>1) Создаете прямоугольник.</p><p class='o'>2) Когда он выделен либо нажимаете F2, либо 2-м нажатием левой кн. мыши.</p><p class='o'>3) Далее нажимаете правой кнопкой мыши и выбираете Insert Field...(Вставка поля...)</p><p class='o'>4) В появившемся окне в Category(Категория) выберите Custom Formula(Другая формула).</p><p class='o'>5) И в строке снизу введите необходимую формулу.</p><p class='o'>Вот и все.</p>
<p class='n' id='a223'>Как определить размер (длину в мм) текстовой строки?</p>
<p class='v'>Подскажите, как определить размер (длину в мм) текстовой строки, а не размер шейпа в котором она написна.</p><p class='v'>Нужно для функции на VBA.</p>
<p class='o'>На основе примера из документации:</p>
<p class='t'>Sub&nbsp;Text_width()</p><p class='t'>Dim&nbsp;shpObj&nbsp;As&nbsp;Visio.Shape</p><p class='t'>Set&nbsp;pagsObj&nbsp;=&nbsp;ThisDocument.Pages</p><p class='t'>Set&nbsp;pagObj&nbsp;=&nbsp;pagsObj.Item(1)</p><p class='t'>Set&nbsp;selectObj&nbsp;=&nbsp;ActiveWindow.Selection</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;ActiveWindow.Selection.Item(1)</p><p class='t'>shpObj.Text&nbsp;=&nbsp;"Text&nbsp;here"&nbsp;'пишем&nbsp;текст&nbsp;в&nbsp;фигуру&nbsp;или&nbsp;оставляем</p><p class='t'>shpObj.AddSection&nbsp;visSectionUser&nbsp;'добавляем&nbsp;раздел</p><p class='t'>shpObj.AddRow&nbsp;visSectionUser,&nbsp;visRowUser&nbsp;+&nbsp;0,&nbsp;0&nbsp;'добавляем&nbsp;строку</p><p class='t'>Set&nbsp;celObj&nbsp;=&nbsp;shpObj.Cells("User.Row_1")&nbsp;'назначаем&nbsp;ячейку</p><p class='t'>celObj.Formula&nbsp;=&nbsp;"TEXTWIDTH(TheText)"&nbsp;'забиваем&nbsp;формулу</p><p class='t'>TextWTH&nbsp;=&nbsp;celObj.Result(visMillimeters)&nbsp;'забираем&nbsp;результат</p><p class='t'>MsgBox&nbsp;TextWTH,&nbsp;,&nbsp;"Text&nbsp;width"&nbsp;'показываем&nbsp;результат</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a224'>Как программно прижать текстовый блок коннектора к одному из концов?</p>
<p class='v'>Как программно прижать текстовый блок коннектора к одному из концов. Пожалуйста, помогите.</p>
<p class='o'>Например, так.</p>
<p class='t'>Sub&nbsp;Text_position()</p><p class='t'>Dim&nbsp;shpObj&nbsp;As&nbsp;Visio.Shape</p><p class='t'>Set&nbsp;pagsObj&nbsp;=&nbsp;ThisDocument.Pages</p><p class='t'>Set&nbsp;pagObj&nbsp;=&nbsp;pagsObj.Item(1)</p><p class='t'>Set&nbsp;selectObj&nbsp;=&nbsp;ActiveWindow.Selection</p><p class='t'>Set&nbsp;shpObj&nbsp;=&nbsp;ActiveWindow.Selection.Item(1)</p><p class='t'>Set&nbsp;celObj1&nbsp;=&nbsp;shpObj.Cells("TxtPinX")&nbsp;'назначаем&nbsp;ячейку</p><p class='t'>Set&nbsp;celObj2&nbsp;=&nbsp;shpObj.Cells("TxtPinY")&nbsp;'назначаем&nbsp;ячейку</p><p class='t'>celObj1.Formula&nbsp;=&nbsp;"Width*1"&nbsp;'прижимаем&nbsp;к&nbsp;низу</p><p class='t'>celObj2.Formula&nbsp;=&nbsp;"Height*1"&nbsp;'прижимаем&nbsp;к&nbsp;низу</p><p class='t'>celObj1.Formula&nbsp;=&nbsp;"Width*0"&nbsp;'прижимаем&nbsp;к&nbsp;верху</p><p class='t'>celObj2.Formula&nbsp;=&nbsp;"Height*0"&nbsp;'прижимаем&nbsp;к&nbsp;верху</p><p class='t'>End&nbsp;Sub</p>
<p class='n' id='a225'>Как определить к какому именно конекшен поинту произошло подключение?</p>
<p class='v'>Меня интересует именно раздел работа VB с Visio. Вопрос как определить к какому именно конекшен поинту произошло подключение и запросить у этого объекта кастомные свойства. То есть, есть труба которая подключается например к емкости нужно понять, к чему она подключена (емкость, клапан, насос, узел), к какой части емкости верх низ середина, и запросить кастомные свойства этого объекта в зависимости от места подключения к нему.</p>
<p class='o'>Коннекторы с точки зрения анализа соединений отличаются от прочих шейпов.</p><p class='o'>Труба у Вас наверное будет коннектором. У коннектора нужно смотреть коллекцию Connects. В ней будет столько элементов, сколько раз этот коннектор подключен куда-либо. Если труба - ConnectorObj, то коллекция - ConnectorObj.Connects, число подключений - ConnectorObj.Connects.Count.</p><p class='o'>Вычислить, к чему она подключена, можно через свойство ToSheet. Если у Вас на рисунке выбрана только эта труба, то ActiveWindow.Selection(1).Connects(1).ToSheet.Master.Name даст имя мастер-шейпа элемента, подключенного к первому концу трубы.</p><p class='o'>А вот у емкости и прочих шейпов смотреть надо уже другую коллекцию - FromConnects (вместо Connects) и свойство FromSheet вместо ToSheet. То есть вроде как смотрим с обратной стороны на то же подключение.</p><p class='o'>Ну, и еще два свойства - FromPart и ToPart объекта Connect помогут определить часть шейпа (там куча констант, показывающих низ, верх, номер Connection Point'а  и т.д.)</p>
<p class='n' id='a226'>Как изменить размеры шейпов по данным Excel?</p>
<p class='v'>Хотелось бы из VBA екселевского изменить размеры шейпов... по данным того же екселя.</p><p class='v'>Я что то не понимаю в иерархии объектов Visio, потому что ни как не могу найти к чему относиться свойство height, отвечющее за высоту шейпа....</p><p class='v'>вот:</p><p class='v'>pagsObj.Item(1).Shapes.Item("Vertical text 3-D bar blue.1")....height=3 что поставить вместо точек?</p>
<p class='o'>Можно, например, так:</p><p class='o'>pagsObj.Item(1).Shapes.Item(1).Cells("height").Formula = 3</p><p class='o'>Здесь height, как ячейка.</p>
<p class='n' id='a227'>Как сослаться на шейп на другой странице?</p>
<p class='v'>Есть созданный мастер-шейп с кучей Custom Properties. Напр., именуемый в шейп-листе как Spec.3</p><p class='v'>Чтобы извлечь нужное свойство, я пишу в Custom formula:</p><p class='v'>=Spec.3!Prop.XXX.</p><p class='v'>Это работает в пределах страницы</p><p class='v'>Чтобы обратиться к нему с другой страницы, я, ессно, пишу</p><p class='v'>=Pages[Page-X]!Spec.3!Prop.XXX</p><p class='v'>в ответ - Bad ShapeSheet name...</p><p class='v'>интересно, что с не-мастер шейпом, т.е. именуемым Sheet.XX все работает... Где загвоздка?</p><p class='v'>З.Ы. Сорри за столь наивные вопросы по синтаксису, но толкового руководства под рукой нет... может, подскажете, где взять?</p><p class='v'>З.З.Ы. MS Visio 2002</p>
<p class='o'>Похоже, что здесь в Visio 2002 просто присутствует ошибка. Я, правда, не наталкивался до этого на нее, потому что стараюсь использовать ссылки только вверх или в сторону, но не вверх-вниз, как в данном случае.</p><p class='o'>Вот что я сейчас высмотрел.</p><p class='o'>Помещаем на Page-1 прямоугольник и два шейпа Triangle. Второму из них даем имя sh1.</p><p class='o'>Первый из них отзывается на:</p><p class='o'>Sheet.2</p><p class='o'>Triangle</p><p class='o'>Второй на:</p><p class='o'>Sheet.3</p><p class='o'>Triangle.3</p><p class='o'>С первой страницы работают ссылки на Triangle.3!Width и Sheet.3!Width. Причем при попытке ввести ссылку Sheet.3!Width она автоматически заменяется на Triangle.3!Width. То есть Visio так сказать "помогает" пользователю.</p><p class='o'>Даем второму треугольнику еще и уникальное имя, например sh1. Теперь он отзывается на:</p><p class='o'>Sheet.3</p><p class='o'>sh1</p><p class='o'>Подмена идет уже на sh1.</p><p class='o'>Начинаем на него ссылаться с Page-2 и видим, что при вводе</p><p class='o'>=Pages[Page-1]!Sheet.3!Width подмена идет уже на =Pages[Page-1]!Triangle.3!Width, а не на =Pages[Page-1]!sh1!Width, как на первой странице.</p><p class='o'>Эта ссылка еще работает.</p><p class='o'>Но! Повторно ее ввести нельзя! То есть, при попытке самому ввести =Pages[Page-1]!Triangle.3!Width получаешь ошибку.</p><p class='o'>Более того. Если этот файл сохранить не в .vsd, а в .vdx, то Visio уже не может его прочитать. Говорит, что формула сломана и он ее изменяет на 0.</p><p class='o'>Вывод:</p><p class='o'>1. Желательно при ссылках в Visio 2002 избегать обратного движения по дереву. То есть, если уж Вы сослались на другую страницу (вверх по дереву), то не опускаться до ее шейпов.</p><p class='o'>2. Если такая ссылка все-таки нужна, то стараться использовать неименованные шейпы, чтобы Visio не имел возможности "помочь" Вам в духе Microsoft.</p><p class='o'>3. Проверить, как это работает в Visio 2003. Ошибка настолько явная, что там она вполне может быть уже исправлена.</p><p class='o'>В DVS написано, что ссылка по имени "Shapename.ID!Cellname" работает только в пределах листа. (DVS.pdf p.74 "Rules for cell references in formulas").</p><p class='o'>В остальных случаях используется "Sheet.ID!Cellname"</p><p class='o'>В Visio 2003 все работает так же.</p>
<p class='n' id='a228'>Как из скрипта можно установить единицу измерения?</p>
<p class='v'>Есть какая то заморочка с дюймами... вообще хочу работать с см, поэтому меняю для странички в Page setup inches на cm все вроде ок..</p><p class='v'>Потом, при расстановке фигур по страничке не могу разобраться в чем идет расчет, например:</p><p class='v'>elements(0).SetBegin x / 2.54, (2 + Kcell_total(0) / step) / 4.54</p><p class='v'>при значении Kcell_total(0)=4241, x=2 начало получается расположенным в точке (2;4,5) - каким образом.... не могу понять и попутно как из скрипта можно установить единицу измерения для pages или для page..</p>
<p class='o'>Единица измерения переключается масштабом</p>
<p class='t'>&nbsp;ActivePage.PageSheet.Cells("PageScale").Formula&nbsp;=&nbsp;"1&nbsp;cm"</p><p class='t'>&nbsp;ActivePage.PageSheet.Cells("DrawingScale").Formula&nbsp;=&nbsp;"1&nbsp;cm"</p>
<p class='o'>переведет в см, а</p>
<p class='t'>&nbsp;ActivePage.PageSheet.Cells("PageScale").Formula&nbsp;=&nbsp;"1&nbsp;in"</p><p class='t'>&nbsp;ActivePage.PageSheet.Cells("DrawingScale").Formula&nbsp;=&nbsp;"1&nbsp;in"</p>
<p class='o'>переключит в дюймы.</p><p class='o'>Но вводите данные Вы все равно в дюймах, поэтому (2дюйма)/2.54 дает 2 см и отстоит на 2 клеточки от края листа, если единицу измерения установили см. (по Y Вы не сообщили значение step).</p><p class='o'>Короче, видеть Вы будете в см, а вводить в дюймах.</p>
<h2>ShapeSheet</h2>
<p class='n' id='a294'>Подсчет количества элементов</p>
<p class='v'>Имеется рисунок с большим количеством элементов порожденных 10-20 мастерами. Требуется посчитать количество элементов порожденных конкретным мастером. При добавлении поля в произвольный sheet функция ID считает общее количество всех sheet на странице включая саму себя. Может есть способ указать в ID имя конкретного мастера.</p>
<p class='o'>Буду рад, если кто-то меня опровергнет, но кажется на уровне ShapeSheet эта задача не имеет решения, так как в ячейке можно дать любую ссылку, но нельзя последовательно опросить множество Shape. И функция ID дает не количество, а номер последнего Shape, который только иногда совпадает с количеством.</p><p class='o'>Зато на программном уровне задача решается очень легко. Например:</p><p class='o'>- рисуем на листе единственный квадрат (для вывода результатов);</p><p class='o'>- вводим в документ макрос вот такого вида:</p>
<p class='t'>Sub&nbsp;ttt()</p><p class='t'>s1&nbsp;=&nbsp;""</p><p class='t'>&nbsp;&nbsp;For&nbsp;i&nbsp;=&nbsp;1&nbsp;To&nbsp;ActivePage.Shapes.Count</p><p class='t'>	s1&nbsp;=&nbsp;s1&nbsp;+&nbsp;"Name=&nbsp;"&nbsp;+&nbsp;ActivePage.Shapes(i).Name</p><p class='t'>	s1&nbsp;=&nbsp;s1&nbsp;+&nbsp;"&nbsp;&nbsp;&nbsp;Id=&nbsp;"&nbsp;+&nbsp;Str(ActivePage.Shapes(i).ID)&nbsp;+&nbsp;vbCrLf</p><p class='t'>&nbsp;&nbsp;Next</p><p class='t'>ActivePage.Shapes(1).Text&nbsp;=&nbsp;s1</p><p class='t'>End&nbsp;Sub</p>
<p class='o'>- и подцепляем его к нашему квадрату через Format/Behavior/Double-Click/RunMacro/TchisDocument.ttt</p><p class='o'>Теперь при двойном щелчке по этому квадрату наша функция будет последовательно опрашивать все имеющиеся на листе Shapes и писать в качестве текста их имена и ID. На этот лист можно набросать много мастеров или нарисовать Shape и двойным щелчком по первому квадрату обновить их список.</p><p class='o'>Ну, а если мы можем собрать список имеющихся шейпов, то после небольшой модификации можем его рассортировать или подсчитать экземпляры нужных мастеров. Одна беда - как только появляются макросы, Visio будет приставать со своими предупреждениями (хотя это можно и отключить).</p>
<h2>VBA</h2>
<p class='n' id='a295'>Изменение размеров рисунка</p>
<p class='v'>Нарисовал планировку этажа здания. Теперь нужно весь рисунок увеличить в размерах.  После его растягивания некоторые объекты остаются на месте, линии искажаются и т.д.  Как сделать грамотно увеличение?</p>
<p class='o'>Не видя самого рисунка, точно не скажешь. Но есть варианты:</p><p class='o'>1. Если все объекты нарисованы, а не перетащены из трафарета, то нужно объединить их в группу и растягивать всю группу.</p><p class='o'>Это может не работать, если свойство Format/Behavior/Resize behavior каких-то объектов установлено не в Scale with group (изменяться с группой), а в Reposition only (перемещаться без масштабирования). Кстати, по умолчанию устанавливается Use group's setting, что тоже может подойти, но тогда поведение будет зависеть от соответствующей установки в группе.</p><p class='o'>2. То есть нужно бы установить у всех объектов Resize behavior в состояние Scale with group. Это тоже может не помочь, если в каких-то объектах установлены блокировки, то есть в Format/Protection установлены галочки на блокировку изменения каких-то параметров.</p><p class='o'>3. То есть нужно снять лишние блокировки.</p><p class='o'>Это тоже может не помочь, если используются Смарт-шейпы, - объекты, перетащенные с трафаретов и обладающие своей запрограммированной реакцией на изменение внешней среды. К сожалению, изменив эту реакцию, можно подпортить другие важные свойства. Поэтому в данном случае можно попробовать последний способ</p><p class='o'>4. Не растягивая рисунок пользоваться масштабированием.</p><p class='o'>Если все сконцентрировалось, например, в одном углу рисунка, можно сначала обрезать лист так, чтобы он подогнался под заполненную область (File/Page Setup/Page Size установить галочку в Size to fit drawing contents), а потом разместить этот лист на полном печатном листе. (File/Page Setup/Setup - галочки Center horizontally и Center vertically центрируют изображение, а установка Fit to 1 sheet(s) across by 1 sheet(s) down максимально растянет рисунок во весь печатный лист). Можно воспользоваться и процентным масштабированием.</p>
<!-- --------------------------- -->
<div id="menu-line">
<a href="mailto:gCroc@yandex.ru">Gennady Tumanov</a>
</div>

</div>
</body>
</html>
